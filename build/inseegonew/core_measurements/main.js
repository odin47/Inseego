/* core_measurements 9.12.5 2018-08-27T16:54:16+00:00 b689bea882f7+ (release/9.12.0) tip */
angular.module("c8y.core.measurements2",["ui.bootstrap"]),function(){"use strict";function e(e,t,n,a,i,r,o,s){function l(t){e.supportedMeasurements=t,d()}function c(){a.getSupportedMeasurements(p).then(l)}function u(){var t=e.supportedMeasurements||[],a=e.pagination||{},i=a.pageSize,r=a.options||{},o=a.page-1,s=(r[o]||{}).startFrom;return _.isUndefined(i)||_.isUndefined(s)||(t=n("limitTo")(t,i,s)),t}function d(){function t(t,n){i.addAction({text:t,action:function(){var t=_.map(e.filters,function(e){return{dateFrom:moment(e.dateFrom).format(r.dateFullFormat),dateTo:moment(e.dateTo).format(r.dateFullFormat)}});s.downloadReportForDevice(n,p,u(),t)}})}t("Download as CSV",o.format.csv),t("Download as Excel",o.format.xlsx)}function m(){e.filters=[],c()}var f=this,p=t.deviceId;f.realtime=!0,e.deviceId=p,m()}e.$inject=["$scope","$routeParams","$filter","c8yDevices","c8yActions","c8yBase","c8yMeasurements","MeasurementsReportSvc"],angular.module("c8y.core.measurements2").controller("measurementsCtrl",e)}(),angular.module("c8y.core.measurements2").directive("c8yMeasurementLineChart",["$window","$timeout","c8yLineChartSvc",function(e,t,n){"use strict";function a(e,t){return O(t)}function i(e,t){return{width:e.width(),height:C+E.bottom+E.top}}function r(e,t){return d3.time.scale().range([0,e.width-E.left*(t||1)-1]).nice()}function o(){return d3.scale.linear().range([C,0]).nice()}function s(e,t){var n=d3.format(".2s"),a=function(e){return String(e).length>4?n(e):e};return d3.svg.axis().scale(e).orient(t||"left").ticks(6).tickFormat(a)}function l(e){return d3.svg.axis().scale(e).orient("bottom").ticks(6).tickFormat(U)}function c(e,t){$(e).find(".graph").empty();var n=d3.select(e[0]||e).select(".graph").append("svg").attr(t).style({height:t.height+"px"});return n.append("defs").append("svg:clipPath").attr("id","clip").attr("transform","translate("+E.left+", "+E.top+")").append("svg:rect").attr("id","clip-rect").attr("x","0").attr("y","-5").attr("width",t.width).attr("height",t.height+5),n.append("g").attr("class","graphContainer").attr("clip-path","url(#clip)"),n.append("g").attr("class","focusContainer").attr("clip-path","url(#clip)"),n}function u(e,t,n){return d3.svg.area().interpolate("linear").x(e).y0(t).y1(n)}function d(e){var t=e.kpi,n=_.reduce(e.values,function(e,t){return e.push(t.min),e.push(t.max),e},[]),a=d3.max(n),i=d3.min(n),r=_.isUndefined(t&&t.min)?0:t.min,o=_.isUndefined(t&&t.max)?a:t.max;return o<0&&(o=0),[d3.min([r,i]),d3.max([o,a])]}function m(e,t,n){var a=e.select(".graphContainer"),i=a.selectAll(".area").data(n);i.exit().remove(),i.enter().append("g").attr("transform","translate("+E.left+", "+E.top+")").attr("class","area").append("path"),i.select("path").attr("d",function(e){return e.pathFn(e.dataPoints)}).style({opacity:.8,stroke:function(e){return e.kpi&&e.kpi.color||e.color},fill:function(e){return e.kpi&&e.kpi.color||e.color}})}function f(e,t){var n=p(t);return e.selectAll(".yaxis").remove(),_.forEach(n,_.partial(v,e)),n}function p(e){var t=[];return _.forEach(e,function(e){var n=e.scale.domain(),a=n[0],i=n[1],r=e.kpi&&e.kpi.unit||e.unit,s=_.find(t,{min:a,max:i})||_.find(t,function(e){return e.units.indexOf(r)>-1});s||(s={scale:o().domain([a,i]),min:a,max:i,units:[],colors:[],kpis:[]},t.push(s));var l=s.scale.domain(),c=l[0],u=l[1];s.scale.domain([d3.min([a,c]),d3.max([i,u])]),e.kpi&&s.kpis.push(e.kpi),s.units.indexOf(r)===-1&&s.units.push(r),s.colors.push(e.color),e.yaxis=s}),_.forEach(t,function(t){var n=t.scale;_.forEach(_.filter(e,{yaxis:t}),function(e){e.scale=n})}),t}function v(e,t,n){var a=n?"right":"left",i=s(t.scale,a),r=e.append("g").attr("class","yaxis axis"),o=T(r,n);return o.text(h(t)),_.forEach(t.colors,function(e,a){r.append("circle").attr({cx:n?30:-35,cy:C-7*a,r:5,fill:_.partial(function(n){var a=t.kpis[n];return a&&a.color||e},a)})}),r.attr({transform:g(e,n)}).call(i)}function h(e){var t=e.kpis||[],n=e.units||[],a="";if(1===t.length){var i=t[0],r=i.unit||n[0];a=i.label+(r?" ["+r+"]":"")}else a=n.join(" / ");return a}function g(e,t){var n=Number(e.attr("width")),a=E.top,i=t?n-t*E.left-1:E.left;return"translate("+i+", "+a+")"}function y(e,t){var n=l(t),a=e.select(".xaxis");a.empty()&&(e.append("g").attr("class","xaxis axis").attr("transform","translate("+E.left+", "+(C+E.top)+")"),a=e.select(".xaxis")),a.call(n)}function x(e){return e.append("g").attr("transform","translate("+E.left+", "+E.top+")").append("line").style({visibility:"hidden",stroke:"#999999","stroke-dasharray":"3,3",opacity:.5}).attr({class:"overline",y1:0,y2:C})}function b(e,t,a,i){var r="focusPoint"+i,o=a[r];if(!o){var s=n.getDOMId(a,i),l=e.select("#"+s);o=l.empty()?e.append("g").attr("transform","translate("+E.left+", "+E.top+")").attr("class","focusPoint").attr("id",s).append("circle").style("visibility","hidden").attr({cx:0,cy:0,r:5}):l.select("circle")}return o.attr("fill",_.partial(function(e,t){return t.kpi&&t.kpi.color||e},t,a)),o}function T(e,t){var n=t?30:-35,a=t?90:-90;return e.append("text").attr({x:n,y:C/2,"text-anchor":"middle",transform:"rotate("+a+" , "+n+","+C/2+")"}).style({fill:"#999","font-size":"10px"})}function w(e,t){e.attr("transform","translate("+(t||0)+", 0)")}function D(e,t,n){e.attr({cx:t,cy:n})}function S(e){e.style("visibility","visible")}function k(e){e.style("visibility","hidden")}function F(e,t){var n=e.find(".graphHoverInfo"),a=e.find(".graphHoverInfoCurrent");return a.css("bottom","7px"),{hover:n,current:a}}function M(e,t,n){e.css("right",t.width-n+"px")}function I(e,t){e.find(".loadingIcon").css("display",t?"inline-block":"none")}function P(e,t,n,i){var r=(e.select(".graphContainer"),e.select(".focusContainer"));n.color||(n.color=n.kpi&&n.kpi.color||a(n,i)),n.focusPoint0=b(r,n.color,n,0),n.focusPoint1=b(r,n.color,n,1),n.moveFocusPoints||(n.moveFocusPoints=function(e){var a=this.getNearIndex(e),i=this.nearValue=n.values[a],r=this.nearTime=n.timelist[a],o=this.scale;_.forEach([this.focusPoint0,this.focusPoint1],function(e,n){var a=["min","max"];e&&D(e,t(r),o(i[a[n]]))})});var s=o().domain(d(n)),l=function(e,n){return t(e.time)},c=function(e,t){return n.scale(e.val.min)},m=function(e,t){return n.scale(e.val.max)};n.scale=s,n.pathFn=u(l,c,m)}function A(n,a,o,s){function l(){$=i(a),A=F(a,$),L=c(a,$),O=x(L,$),U=r($),D(),u()}function u(e){var t=d(e);y(L,t)}function d(e){var t,a=n.filter.dateFrom,i=n.filter.dateTo;return a&&i?(n.realtimeState||(i=e?d3.max([i,d3.max(_.flattenDeep(_.map(e,"timelist")))]):i),U=t=U.domain([a,i]),t):U}function p(e){if(_.isArray(e)){var t=d(e);_.forEach(e,_.partial(P,L,t));var n=f(L,e);U.range([0,$.width-n.length*E.left-1]),m(L,t,e),u(e),h()}}function v(){l(),p(n.series)}function h(){var e,a=n.series;try{e=d3.mouse(this)[0]}catch(t){e=h.__cachedMouse}finally{h.__cachedMouse=e}var i=U.invert(e);w(O,e),n.currentTime=i,n.nearTime=_.reduce(a,function(e,t){return 0===e?t.nearTime:e!==!1&&(!!moment(t.nearTime).isSame(e,"second")&&t.nearTime)},0);var r=t(function(){_.isFunction(r.cancel)&&r.cancel(),_.forEach(a,function(e){e.moveFocusPoints(i)}),M(A.hover,$,Math.round(e+E.left)),M(A.current,$,Math.round(e+E.left-1))})}function g(){T(!0)}function b(){T(!1)}function T(e){var a=n.series;t(function(){_.forEach(_.union(_.map(a,"focusPoint0"),_.map(a,"focusPoint1"),[O]),e?S:k),n.showHover=e})}function D(){return L.append("rect").attr({width:$.width,height:C,transform:"translate("+E.left+", "+E.top+")"}).style({fill:"none","z-index":1e3,"pointer-events":"all"}).on("mouseenter",g).on("mouseleave",b).on("mousemove",h)}a.addClass("c8yGraphContainer");var $,A,L,O,U,N=[];n.$watch("series",function(e){N=e,p(e)}),n.$on("newData",function(){p(n.series)}),n.$watch("loading",_.partial(I,a));var H=_.throttle(v,10);e.addEventListener("resize",H),n.$on("dashboardResize",H),n.$on("$destroy",function(){e.removeEventListener("resize",H)}),n.$watch("interval",function(e){"undefined"!=typeof e&&null!==e&&(n.filter.interval=e)}),n.$watch("filter",function(e){n.dateFrom=e&&e.dateFrom,n.dateTo=e&&e.dateTo},!0),l()}var L=200,C=L,E={left:50,bottom:20,top:10},O=d3.scale.category10(),U=d3.time.format.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%H:%M",function(e){return e.getMinutes()}],["%H:%M",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!=e.getDate()}],["%b %d",function(e){return 1!=e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",function(){return!0}]]);return{scope:{interval:"=?",aggregationType:"=?",autoAggregationOff:"@",dateFrom:"=?",dateTo:"=?",startRealtime:"=?",selectedKpis:"=?kpis",hideRealtime:"=?",hideHeader:"=?",frag:"@measurementType",deviceId:"@",datapoints:"=?"},restrict:"EA",link:A,templateUrl:"core_measurements/views/lineChart.html",controller:"c8yLineChartCtrl"}}]),function(){"use strict";function e(e,t,n,a,i,r,o){function s(){e.filter.dateFrom&&e.filter.dateTo&&e.filter.aggregationType&&u()}function l(t){e.series=t,k.length&&n(function(){m(_.flattenDeep(k)),k.length=0}),c()}function c(){e.loading=!1}function u(){var n=S.dateFrom,r=S.dateTo,o=S.aggregationType.value,s=e.deviceId,u=e.frag,m=e.selectedKpis,f=e.datapoints;if(e.title=i.humanizeFragment(u||""),n&&r&&(s||f)&&(u||m||f))if(e.loading=!0,f){var p=_.groupBy(f,function(e){return e.__target.id});t.all(_.map(p,function(e,t){return a.getSeries(t,e,n,r,e.aggregation||o)})).then(function(e){return d(),l(_.flattenDeep(e))}).finally(c)}else m?a.getSeries(s,m,n,r,o).then(l).finally(c):u&&a.getKpi(s).then(function(t){a.getSeries(s,u,n,r,o).then(function(n){return e.truncated=n.truncated,_.map(n,function(e){return e.kpi=a.getKpiOfSerie(e,t),e})}).then(l)}).finally(c)}function d(){L||(L=e.$watch("datapoints",u,!0))}function m(t){!e.loading&&e.series&&e.series.length?a.appendMeasurement(e.frag||e.kpis,t,e.series).hasNew&&n(_.bind(e.$broadcast,e,"newData")):(!e.series||e.series.length||e.loading||(e.$broadcast("updateInterval"),n(u)),k.push(t))}function f(){return!!(e.filter&&e.filter.dateFrom&&e.filter.dateTo&&e.filter.aggregationType&&(e.deviceId||e.datapoints)&&(e.selectedKpis||e.frag||e.datapoints))}function p(){var t=e.$watch(f,function(n){n&&(s(),e.$on("search",s),t())})}function v(t){t&&f()?(e.$broadcast("updateInterval"),n(s),A.start()):A.cancel()}function h(t){e.filter.aggregationType=_.find(M,{value:t})||M[0],F=!0,s()}function g(t){e.filter.aggregationType=_.find(M,{value:t})||M[0],e.aggregationTypeDescription=e.filter.aggregationType.name.toLowerCase()}function y(){var t,n,a=moment(e.filter.dateFrom),i=moment(e.filter.dateTo),r=moment.duration(i.diff(a));e.autoAggregationOff||F||!D||D.asMilliseconds()===r.asMilliseconds()||_.forEach(I,function(e){t=!e.minDuration||e.minDuration&&e.minDuration.asMilliseconds()<=r.asMilliseconds(),n=!e.maxDuration||e.maxDuration&&e.maxDuration.asMilliseconds()>r.asMilliseconds(),t&&n&&g(e.aggregationType)}),D=r}function x(e,t){t.fromLastConnect>P&&u()}function b(){e.dateFrom=e.filter.dateFrom,e.dateTo=e.filter.dateTo,e.aggregationType=e.filter.aggregationType.value,e.interval=e.filter.interval}function T(){e.aggregationType=e.filter.aggregationType.value,e.selectedAggregationTypeValue=e.filter.aggregationType.value}function w(t){if(t.disabledWhenLessThan){var n=t.disabledWhenLessThan;return!(moment(e.dateTo).diff(e.dateFrom,n.unit)<n.qty)}return!0}var D,S={},k=[],F=!1,M=[{value:"NONE",name:r("No aggregation")},{value:"MINUTELY",name:r("Minutely"),disabledWhenLessThan:{qty:1,unit:"minutes"}},{value:"HOURLY",name:r("Hourly"),disabledWhenLessThan:{qty:1,unit:"hours"}},{value:"DAILY",name:r("Daily"),disabledWhenLessThan:{qty:1,unit:"days"}}],I=[{minDuration:moment.duration(1,"months"),maxDuration:null,aggregationType:"DAILY"},{minDuration:moment.duration(1,"days"),maxDuration:moment.duration(1,"months"),aggregationType:"HOURLY"},{minDuration:moment.duration(1,"minutes"),maxDuration:moment.duration(1,"days"),aggregationType:"MINUTELY"},{minDuration:null,maxDuration:moment.duration(1,"minutes"),aggregationType:"NONE"}],P=125,$=!1,A=o(function(){if(!$){var t=moment(e.filter.dateTo).diff(e.filter.dateFrom);e.filter.dateTo=new Date,e.filter.dateFrom=moment().subtract(t).toDate(),e.$broadcast("newData")}});e.onDatepickerOpen=function(e){e?n(function(){$=!0},50):$=!1};var L;e.filter=S,e.aggregationTypes=M,e.onAggregationTypeChangedManually=h,e.isAggregationTypeEnabled=w,e.getData=u,e.onData=m,e.$watch("realtimeState",v),e.$watch("aggregationType",g),e.$watch("filter.dateFrom",y),e.$watch("filter.dateTo",y),e.$watch("filter.aggregationType",T),e.$on("connect",x),e.$on("changeFilters",b),e.$on("$destroy",A.cancel),p()}e.$inject=["$scope","$q","$timeout","c8yLineChartSvc","c8yBase","gettext","RTAutoMove"],angular.module("c8y.core.measurements2").controller("c8yLineChartCtrl",e)}(),function(){"use strict";function e(e,t,n,a,i,r){function o(e){return _.map(e.matchKpi,function(e){return e.c8y_Kpi})}function s(t){var a=s._cache[t]=s._cache[t]||n.listKpiForDevice(t).then(o);return a=a.catch(function(t){var n=t.data||{},a=r.getTranslatedServerMessage(n.message);return i.add({type:"danger",text:a,detailedData:t}),e.reject(t)})}function l(e){var t=e.values,n=_.map(e.series,function(e){return e.fragment=e.type,e.values=[],e.timelist=[],e.dataPoints=[],e}),a=[];return _.forEach(t,function(e,t){var i=moment(t).toDate();a.push(i),_.forEach(n,function(t,n){var a=e[n];!_.isObjectLike(a)||_.isUndefined(a.min)||_.isUndefined(a.max)||(t.values.push(a),t.timelist.push(i),t.dataPoints.push({val:a,time:i}))})}),n=_.filter(n,function(e){return e.values.length}),n=_.map(n,m),n.truncated=e.truncated||!1,n}function c(e,n,i,r,o){var s={source:e,dateFrom:i?moment(i).format(a.dateFullFormat):i,dateTo:r?moment(r).format(a.dateFullFormat):r,aggregationType:"NONE"!==o?o:void 0};return t.listSeries(s).then(l).then(function(e){var t=_.isString(n),a=_.isArray(n),i=e.truncated;if(t){var r=n;e=_.filter(e,{type:r})}else if(a){var o=n;e=_.filter(e,function(e){return _.find(o,{fragment:e.fragment,series:e.name})}),_.forEach(e,function(e){e.kpi=f(e.type,e.name,o)})}return e.truncated=i,e})}function u(e,t){var n=t,a=e.timelist,i=d3.bisect(a,n,1,a.length-1),r=a[i-1],o=a[i],s=_.isUndefined(r)?i:_.isUndefined(o)?i-1:n-r<o-n?i-1:i;return s}function d(e){return d3.max(_.flattenDeep(_.map(e,"timelist")))}function m(e){return _.assign(e,{getNearIndex:function(e){return u(this,e)}})}function f(e,t,n){return _.find(n,{fragment:e,series:t})}function p(e,t){return f(e.fragment,e.name,t)}function v(e,t){var n=_.reduce(t,function(t,n){return _.forEach(n[e],function(e,n){t[n]||(t[n]={unit:e.unit}),t[n].unit||(t[n].unit=e.unit)}),t},{}),a=_.keys(n),i=[],r=[];return _.forEach(t,function(t){var o=t[e],s=moment(t.time).toDate();_.forEach(a,function(t,a){var r=i[a]=i[a]||{fragment:e,name:t,unit:n[t].unit,values:[],timelist:[],dataPoints:[]};if(o[t]){var l=o[t].value,c={min:l,max:l};r.values.push(c),r.timelist.push(s),r.dataPoints.push({time:s,val:c})}}),r.push(s)}),{timeList:r,series:i}}function h(e,t,n){var a=_.isString(e),i=(_.isArray(e),a?[e]:_.uniq(_.map(n,"fragment"))),r=!1;return t=_.isArray(t)?t:[t],_.forEach(t,function(e){var o=moment(e.time).toDate(),s=_.flattenDeep(_.map(i,function(e){return v(e,t).series}));r=r||s.length,_.forEach(n,function(e){var t=_.find(s,{fragment:e.fragment,name:e.name});if(t){var n=d3.bisect(e.timelist,o);e.timelist.splice(n,0,o),e.values.splice(n,0,_.head(t.values)),e.dataPoints.splice(n,0,_.head(t.dataPoints)),t.found=!0}}),a&&_.forEach(_.filter(s,function(e){return!e.found}),function(e){n.push(e)})}),{hasNew:r,series:n}}function g(e,t){var n=e.kpi&&e.kpi.__target?"target"+e.kpi.__target.id:"",a=[n,e.fragment,t,e.name].join("");return"id"+window.btoa(a).replace(/[\/=]/gi,"_")}return s._cache={},{getKpi:s,getSeries:c,getMaxTimeFromSeries:d,getKpiOfSerie:p,appendMeasurement:h,getDOMId:g}}e.$inject=["$q","c8yMeasurements","c8yKpi","c8yBase","c8yAlert","c8yLocales"],angular.module("c8y.core.measurements2").service("c8yLineChartSvc",e)}(),angular.module("c8y.core.measurements2").directive("c8yTimeInterval",["INTERVAL_CONSTANTS",function(e){"use strict";function t(t){return t.selInterval===e.custom}function n(e){var t=e.selInterval;return t&&t.unit?(e.dateTo=moment().add(1,"seconds").toDate(),e.dateFrom=moment().subtract(t.qty,t.unit),["hours","minutes"].indexOf(t.unit)===-1&&e.dateFrom.startOf("day"),e.dateFrom=e.dateFrom.toDate()):(e.dateFrom=e.dateFrom?moment(e.dateFrom).startOf("day").toDate():e.dateFrom,e.dateTo=e.dateTo?moment(e.dateTo).endOf("day").toDate():e.dateTo),!!t.unit}return{scope:{dateFrom:"=dateFrom",dateTo:"=dateTo",hideSelector:"=?",interval:"=?",intervalDescription:"=?",onDatepickerOpen:"&"},restrict:"EA",templateUrl:"core_measurements/views/timeInterval.html",controller:["$scope","$timeout",function(a,i){function r(e){a.interval=a.selInterval&&a.selInterval.unit,i(u,0);var t=n(a);(t||e)&&i(c,0)}function o(){a.selInterval=_.find(e.intervals,{unit:_.isUndefined(a.interval)?"hours":a.interval}),a.intervalDescription=a.selInterval.txt,r()}function s(e){a.onDatepickerOpen({isOpen:e})}var l,c=_.bind(a.$emit,a,"search"),u=_.bind(a.$emit,a,"changeFilters");l=i(o,300),a.timeIntervals=e.intervals,a.isCustom=_.partial(t,a),a.onChange=r,a.search=r,a.$on("updateInterval",_.partial(n,a)),a.$watch("interval",function(t){_.isUndefined(t)||(l&&(i.cancel(l),l=null),a.selInterval=_.find(e.intervals,{unit:t}),a.intervalDescription=a.selInterval.txt,n(a))}),a.$watch("openFrom",s),a.$watch("openTo",s)}]}}]),function(){"use strict";function e(e,t){return"translate("+e+", "+t+")"}function t(e,t,n){return"rotate("+e+","+t+", "+n+")"}function n(n,a,i,r,o,s,l){function c(e,t,n,a,i){var r=i,o="NONE"!==a?a:void 0;return s.listForDataPoint(e,t,n,o,r)}function u(e,t){var n=this,a=$(e),i=a.find(".chart-container").length;n._hasContainer=i,n.el=i?a.find(".chart-container"):a,n.parentEl=n.el.parent(),n.items=[],n.dimensions=_.throttle(n._dimensions.bind(n),700),n.render=_.throttle(n._render.bind(n),200,{leading:!1,trailing:!0}),n.init(t)}function d(e,t){var n=this;return n.chart=e,n.dataPoint=t,n.hoverItems=[],n.values=[],n.implicitDomain={},n.bisect=d3.bisector(function(e){return e.time}).right,n.loadSeriesData=r.latest(c),n}function m(e){var t=this;t.chart=e,e.addItem(t)}function f(e){var t=this;t.chart=e,e.addItem(t),t.series=[]}function p(e){var t=this;t._id=String(Math.random()).substr(2),e.addItem(t),t.chart=e,t.init()}var v=o.getD3Locales().timeFormat.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%H:%M",function(e){return e.getMinutes()}],["%H:%M",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!=e.getDate()}],["%b %d",function(e){return 1!=e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",function(){return!0}]]),h="ddd, ll, LTS",g=[{val:"min",text:l("Minimum")},{val:"max",text:l("Maximum")},{val:"area",text:l("Minimum and maximum")}],y=[{val:"line",text:l("Line")},{val:"points",text:l("Points")},{val:"linePoints",text:l("Line and points")},{val:"bars",text:l("Bars")},{val:"step-before",text:l("Step before")},{val:"step-after",text:l("Step after")}],x=[{val:void 0,text:l("Auto")},{val:"left",text:l("Left")},{val:"right",text:l("Right")}];return d3.selection.prototype.dblTap=function(e){var t=0;return this.each(function(){d3.select(this).on("touchstart",function(n){return d3.event.timeStamp-t<500?(d3.event.preventDefault(),d3.event.stopPropagation(),e(n)):void(t=d3.event.timeStamp)})})},u.prototype={sizes:{yAxisWidth:50},margins:{t:20,r:10,b:20,l:10},init:function(e){var t=this,n=t.parentEl,a=t.el,i=t._hasContainer?"25px":0,r=t._hasContainer?{position:"absolute",top:0,right:0,bottom:0,left:0}:{position:"relative"},o=a.parents(".panel-body"),s=a.parents(".grid-stack-item-content").length;if(o.length&&!s&&o.height("320px"),n.css(r),t._hasContainer){var l=n.parent().css("position"),c="absolute"!==l&&"fixed"!==l;c&&n.parent().css({position:"relative"})}a.addClass("c8y-chart"),a.css({display:"block",position:"absolute",top:e.showTime?"55px":i,right:0,bottom:"5px",left:0}),t._id=String(Math.random()).substr(2),t.svg=t.createSvg(),t.hoverBox(),t.svgSeries=t.createSeriesContainer(),t.axisX=new m(t),t.series=[],t.allowSelectPoint=e.allowSelectPoint,t.hoverInfo=new p(t),t.hoverItems=t.renderVerticalLine().concat([t.hoverInfo.el]),t.addEvents()},destroy:function(){this.hoverInfo.destroy()},renderVerticalLine:function(){var t=this,n=t.overline,a=t.selectLine,i=t.box(),r=i.height-t.margins.t-t.margins.b,o=function(n,a,i,r){return t.svg.append("g").attr("transform",e(t.margins.l,t.margins.t)).append("line").style({visibility:"hidden",stroke:n,"stroke-dasharray":a,opacity:r,"pointer-events":"none"}).attr({class:i})};n||(n=t.overline=o("#999999","3,3","overline",.5)),a||(a=t.selectLine=o("#333333",void 0,"selectline",0));var s=[n,a];return _.forEach(s,function(e){e.attr({y1:0,y2:r})}),s},createSeriesContainer:function(){var e=this,t=e.svg,n=e.margins,a=e.box(),i=a.height-n.b-n.t;return e._clipPath=t.append("defs").append("svg:clipPath").attr({id:"clipmask"+e._id}).append("svg:rect").attr({id:"clip-rect"+e._id,x:n.l,y:n.t,width:a.axisXwidth,height:i>0?i:0}),t.append("g").style({"z-index":10}).attr({class:"seriesContainer","clip-path":"url(#clipmask"+e._id+")"})},hoverBox:function t(){var n=this,a=n.box(),t=n._hoverBox,i=a.height-n.margins.b-n.margins.t;return t||(t=n._hoverBox=n.svg.append("rect").style({fill:"transparent",opacity:.3,"z-index":void 0,"pointer-events":"all"})),t.attr({width:a.axisXwidth,height:i>0?i:0,transform:e(a.leftSpace,n.margins.t)}),t},selectionBox:function(t){var n=this,a=n.box(),i=n._selBox,r=a.height-n.margins.b-n.margins.t,o=n._mouseSelectStart;if(r=r>0?r:0,i||(i=n._selBox=n.svg.append("rect").attr({"pointer-events":"none",fill:"rgba(200,200,200, 0.5)"})),o&&t){var s=o[0],l=t[0]-a.leftSpace,c=l>s?s:l,u=s>l?s:l;i.attr({transform:e(a.leftSpace+c,n.margins.t),height:r,width:u-c}).style({visibility:"visible"})}else i.style({visibility:"hidden"})},realtimeMeasurement:function(e){var t=this,n=!1;return _.forEach(t.series,function(t){var a=t.realtimeMeasurement(e);n=n||a}),n},getHoverItems:function(){var e=this,t=_.clone(e.hoverItems);return _.forEach(e.series,function(e){t=_.union(t,e.hoverItems)}),t},showHoverItems:function(e){var t=this,n=t.getHoverItems();t.hoverItemsVisible=!0,n="nolines"===e?_.without(n,t.overline):_.without(n,t.selectLine),_.forEach(n,function(e){e.style&&e.style("visibility","visible"),e.show&&e.show()})},showHoverItemsExceptLine:function(){var e=this;e.showHoverItems("nolines")},hideHoverItems:function(){var e=this;e.hoverItemsVisible=!1,_.forEach(e.getHoverItems(),function(e){e.style&&e.style("visibility","hidden"),e.hide&&e.hide()})},addEvents:function(){function e(){var e=d3.mouse(n.node());t.zoomOut(e[0])}var t=this,n=this.hoverBox();n.on("mouseenter",function(){t.mouseIn=!0,t.showHoverItems()}),n.on("mouseleave",function(){var e=d3.event.relatedTarget;e&&"circle"===e.tagName||(t.hideHoverItems(),t.resetSelectLine(),_.invokeMap(t.series,"mouseleave"),t.mouseIn=!1)});var a=d3.behavior.drag();a.call(n),a.on("dragstart",function(){t._mouseSelectStart=d3.mouse(n.node())}),a.on("dragend",function(){var e=d3.mouse(n.node());t._mouseSelectStart&&e[0]!==t._mouseSelectStart[0]&&t.makeSelection(t._mouseSelectStart,e),t.selectionBox()}),a.on("drag",_.bind(t.onDragSelection,t)),n.on("mousemove",_.bind(t.onMove,t)),n.on("dblclick",e),n.dblTap(e),window.addEventListener("resize",function(){t.render()})},zoomOut:function(e){var t=this,a=t.box(),i=t.margins,r=t.axisX,o=r.scale(),s=r._from,l=r._to,c=moment(o.invert(e+a.leftSpace-i.l)),u=Math.round(2*c.diff(s)),d=Math.round(2*moment(l).diff(c)),m=moment(new Date(Math.max(Date.now(),l)));m=moment.min(m,c.clone().add(d,"ms")),r.updateDates(c.clone().subtract(u,"ms"),m,!0),n.$apply()},moveToCenter:function(e){var t=this,n=t.axisX,a=n._from,i=n._to,r=moment(i).diff(a)/2,o=moment(e).subtract(r),s=moment(e).add(r);n.updateDates(o,s),t.render()},makeSelection:function(e,t){var a=this,i=a.axisX,r=a.box(),o=i.scale(),s=a.margins,l=moment(o.invert(e[0]+r.leftSpace-s.l)),c=moment(o.invert(t[0]+r.leftSpace-s.l)),u=l.isBefore(c)?l:c,d=u===l?c:l;i.updateDates(u,d,!0),n.$apply()},onDragSelection:function(){var e=this;e._mouseSelectStart&&e.selectionBox([d3.event.x,d3.event.y])},onMove:function(t){var n,a=this,i=a.box(),r=a.hoverBox().node(),o=a.margins;try{n=d3.mouse(r),a.axisX._xDragStart&&a.axisX.updateScaleOnDrag(d3.mouse(r)[0])}catch(e){n=a.__cachedMouse||[0,0]}finally{a.__cachedMouse=n}var s=i.leftSpace+n[0]-o.l;a.overline.attr({transform:e(s+1,0)});var l=a.currentHoverTime=a.axisX.scale().invert(s);if(a._selectTime&&"moveToNow"===t)return void a.resetSelectLine();_.forEach(a.series,function(e){e.onMove(l,s)});var c=n[1];_.forEach(a.items,function(e){e.onMove&&e.onMove(l,s,c)})},setSelectTimeWithMouse:function(e){var t=this,n=t.axisX.scale().invert(e);return t.setSelectLine(n),n},setSelectPoint:function(e){var t=this;return t.selectedPoint=e,e.date?(t.setSelectLine(moment(e.date).toDate()),void(t.onSelectPoint&&t.onSelectPoint(t.selectedPoint))):void t.clearSelectPoint()},clearSelectPoint:function(){var e=this;e.onSelectPoint&&e.selectedPoint&&e.selectedPoint.date&&(delete e.selectedPoint,e.onSelectPoint({})),e.clearSelectLine()},setSelectLine:function(t,n){var a=this,i=a.box(),r=a.axisX.scale(),o=a.selectLine,s=r(t),l=!(!a._selectTime||!moment(a._selectTime).isSame(t)),c=s<i.rangeMin||s>i.rangeMax;return a._selectTime=t,c?void(l?a.hideSelectLine():a.moveToCenter(t)):(o.attr({transform:e(s,0)}),o.style("visibility","visible"),o.style("opacity",.5),void(n!==!0&&(a.showHoverItemsExceptLine(),setTimeout(function(){_.forEach(a.series,function(e){e.onMove(t,s)}),_.forEach(a.items,function(e){e.onMove&&e.onMove(t,s)})}))))},clearSelectLine:function(){var e=this;e.hideSelectLine(),delete e._selectTime},hideSelectLine:function(){var e=this,t=e.selectLine;"hidden"!==t.style("visibility")&&(t.style("visibility","hidden"),e.hideHoverItems())},resetSelectLine:function(){var e=this;return!!e._selectTime&&(e.setSelectLine(e._selectTime),!0)},createSvg:function(){return d3.select(this.el[0]).append("svg").style({position:"absolute",top:0,right:0,bottom:0,left:0})},_dimensions:function(){var e=this;return{h:e.el.height(),w:e.el.width()}},box:function(){var e=this,t=e.dimensions(),n=t.h,a=t.w,i=e.getAxisYByOrientation("left"),r=e.getAxisYByOrientation("right"),o=i.length*e.sizes.yAxisWidth||0,s=r.length*e.sizes.yAxisWidth||0,l=e.margins.r+s||0,c=e.margins.l+o||0,u=a-(c+l);return u<0&&(u=0),e.chartBox={height:n>0?n:0,width:a>0?a:0,axisXwidth:u,leftSpace:c,rightSpace:l,rangeMin:o,rangeMax:a-e.margins.l-l},e.chartBox},_render:function(){var e=this;e.updateYaxis();var t=e.box(),n=e.margins;e.renderVerticalLine(),e.selectionBox(),e.hoverBox(),e.axisX.render(),_.invokeMap(e.items,"render"),_.invokeMap(e.series,"render");var a=t.height-n.b-n.t;e._clipPath.attr({x:t.leftSpace,width:t.axisXwidth,height:a>0?a:0}),e.resetSelectLine()||e.onMove()},addItem:function(e){_.isObjectLike(e)&&this.items.indexOf(e)===-1&&this.items.push(e)},removeItem:function(e){this.items=_.without(this.items,e)},updateSeries:function(e,t){var n=this,r=n.axisX._to,o=n.axisX._from,s=n._aggregation,l=_.remove(n.series,function(t){return e.indexOf(t.dataPoint)===-1});_.invokeMap(l,"destroy");var c=_.map(e,function(e){var a,i=_.find(n.series,function(t){return t.dataPoint===e});if(!i){var l=new d(n,e);n.series.push(l),t&&o&&r&&(a=l.loadDataAndRender(o,r,s))}return a}).filter(_.identity),u=c.length?a.all(c):i();return u.finally(function(){n.render()})},loadData:function(e,t,n){var i=this;i._aggregation=n,i.loading=!0;var r=a.all(_.map(i.series,function(a){return a.loadData(e,t,n)}));return r.then(function(e){i.truncated=_.some(e,{truncated:!0})}).finally(function(e){i.loading=!1,i.render()})},scaleY:function(){var e=this.box(),t=e.height-this.margins.t-this.margins.b,n=this.margins.t;return d3.scale.linear().range([t,n]).nice()},getAxisY:function(){var e=this;return _.filter(e.items,function(e){return e instanceof f})},getAxisYByOrientation:function(e){var t=this;return _.filter(t.items,function(t){return t instanceof f&&t.orientation()===e})},updateYaxis:function(){var e=this,t=e.series,n=[],a=e.getAxisY(),i=function(e,t){var n=e.dataPoint,a=t.dataPoint,i=e.scale().domain(),r=t.scale().domain();return n.yAxisType===a.yAxisType&&i[0]===r[0]&&i[1]===r[1]};_.forEach(a,function(e){e.series.length=0}),_.forEach(t,function(t){var r=_.find(n,function(e){return _.find(e.series,function(e){return i(t,e)})});r||(r=a.length?a.shift():new f(e),n.push(r)),r.addSerie(t)}),_.invokeMap(a,"remove")},showDateSelection:function(){this.el.css({top:"55px"})},hideDateSelection:function(){this.el.css({top:"25px"})}},d.prototype={defaultRenderType:"min",defaultLineType:"line",loadDataAndRender:function(e,t,n){var a=this;a.loadData(e,t,n).finally(function(){a.chart.render()})},loadData:function(e,t,n){var a=this,i=a.dataPoint,r=a._aggregation;return this.loadSeriesData(i,e,t,n,a.chart).then(function(e){return r!==n&&(a.values.length=0,a._aggregation=n,a.resetImplicitDomain()),a.appendValues(e.values),e})},appendValues:function(e){var t=this,n=t.values,a=t.implicitDomain;return _.forEach(e,function(e){if(_.isFinite(e.min)&&_.isFinite(e.max)){var i=new Date(e.time),r=i.getTime(),o=_.find(n,function(e){return r===e.time.getTime()}),s={time:i,val:{min:e.min,max:e.max}};n.length&&_.last(n).time.getTime()>r&&(t._valuesSortingNeeded=!0),o?_.assign(o,s):n.push(s),(_.isUndefined(a.min)||e.min<a.min)&&(a.min=e.min),(_.isUndefined(a.max)||e.max>a.max)&&(a.max=e.max)}}),n},destroy:function(){var e=this;e.svg&&e.svg.remove(),e.hoverItems=[],delete e.svg},resetImplicitDomain:function(){var e=this;e.implicitDomain.min=void 0,e.implicitDomain.max=void 0},domain:function(){var e=this,t=e.dataPoint,n=e.implicitDomain,a=_.isUndefined(t.min)||""===t.min?n.min:Number(t.min),i=_.isUndefined(t.max)||""===t.max?n.max:Number(t.max);return(_.isUndefined(a)||isNaN(a))&&(a=d3.min(_.map(e.values,function(e){return e.val.min})),_.isUndefined(a)||(n.min=a),a=a||0),(_.isUndefined(i)||isNaN(i))&&(i=d3.max(_.map(e.values,function(e){return e.val.max})),_.isUndefined(i)||(n.max=i),i=i||0),a===i&&(a-=1,i+=1),[a,i]},scale:function(){var e=this;return e.chart.scaleY().domain(e.domain())},getRenderType:function(){var e=this;return e.dataPoint.renderType||e.renderType||e.defaultRenderType},getLineType:function(){var e=this;return e.dataPoint.lineType||e.lineType||e.defaultLineType},render:function(){var t=this,n=t.chart.svgSeries,a=t.getRenderType(),i=t.getLineType(),r=t.values,o=t.svg;if(!o||o.minOrMax===a&&o.chartType===a||t.destroy(),!t.svg){var s=t.chart.margins;o=t.svg=n.append("g").attr("transform",e(s.l,s.t)).attr("class","series"),o.minOrMax=a,o.chartType=i}t._valuesSortingNeeded&&(delete t._valuesSortingNeeded,r.sort(function(e,t){return e=e.time,t=t.time,e>t?1:e<t?-1:0})),t.chart.allowSelectFocusTime||t.removeOldHiddenValues(),"bars"===i?t._render_bars():"area"!==a?t._render_path(a):t._render_area()},removeOldHiddenValues:function(){var e=this,t=e.values,n=e.chart.axisX._from,a=0;_.forEach(t,function(e,t){if(moment(e.time).isSameOrAfter(n))return a=t-1,!1}),a&&t.splice(0,a)},_render_path:function(e){function t(e){var t=i.chart.axisX.scale();return t(e.time)}function n(t){var n=i.scale();return n(t.val[e])}function a(){return i.dataPoint.color}var i=this,r=i.svg._path;r||(r=i.svg._path=i.svg.append("path"),r.style({"pointer-events":"none"})),i._create_update_focusPoint(1),i._render_path_line(r,t,n,a),i._render_path_points(t,n,a)},_render_path_line:function(e,t,n,a){var i=this,r=i.getLineType()||"linear",o=d3.svg.line().interpolate(r).x(t).y(n);_.includes(["bars","points"],i.getLineType())?(e.remove(),i.svg._path=void 0):e.attr("d",function(){return o(i.values)}).style({fill:"transparent",stroke:a})},_render_path_points:function(e,t,n){var a=this;if(_.includes(["points","linePoints"],a.getLineType())){var i=a.svg.selectAll("circle.point").data(a.values);i.enter().append("circle").attr("class","point"),
i.exit().remove(),i.attr("cx",e).attr("cy",t).attr("r",4).attr("fill","transparent").attr("stroke",n)}else a.svg.selectAll("circle.point").remove()},_render_bars:function(){function e(e){var t=o.chart.axisX.scale(),n={MINUTELY:"minute",HOURLY:"hour",DAILY:"day"},a=t.domain()[0],i=moment(a).add(1,n[e]).toDate();return t(i)-t(a)}function t(e){var t=o.scale();return e||(e="area"===u?"max":u),function(n){return t(n.val[e])}}function n(e){var t=_.max(o.scale().range());return function(n){var a=e(n);return a>t?t:a}}function a(){var e=o.chart.axisX.scale();return o._aggregation?function(t){var n=e(t.time)-l*v()/2;return n+c*v()}:function(t){return e(t.time)}}function i(e){var t=o.scale(),n=t.range();return function(t){return Math.abs(_.max(n)-e(t))}}function r(){var t=1,n=20,a=t;if(o._aggregation){var i=e(o._aggregation);a=i/(l+1),a>n&&(a=n),a<t&&(a=t)}return _.constant(a)}var o=this,s=_.filter(o.chart.series,function(e){return e.getLineType()===o.getLineType()}),l=s.length,c=_.findIndex(s,function(e){return e===o}),u=o.svg.minOrMax,d=function(){return o.dataPoint.color},m=a(),f=t(),p=i(f),v=r(),h={x:m,y:n(f),width:v,height:p,fill:d},g=o.svg.selectAll(".bars").data(o.values),y=g.enter().append("g").style("pointer-events","none").attr("class",function(e,t){return"bar index"+t});if(y.append("rect").attr("class","barmain"),g.exit().remove(),g.select(".barmain").attr(h),"area"===u&&o._aggregation){y.append("rect").attr("class","barmin").style("opacity","0.2");var x=t("min"),b=_.defaults({fill:"#000",y:n(x),height:i(x)},h);g.select(".barmin").attr(b)}o._aggregation||o._create_update_focusPoint(1)},hover:function(e){var t=this,n=t.getRenderType(),a=t.getLineType(),i=t.values[e];t.overPoint=i,i&&(t._focusPointTime=i.time,"bars"===a&&this._hover_bars(e)),t._render_focusPoint(1,"area"!==n?n:"max"),t._render_focusPoint(2,"area"!==n?n:"min")},_hover_bars:function(e){var t=this;t.svg.select(".hover").classed("hover",!1).style({opacity:1}),t.svg.select(".index"+e+" .barmain").classed("hover",!0).style({opacity:.5})},mouseleave:function(){var e=this,t=e.getLineType();"bars"===t&&e.svg.select(".hover").classed("hover",!1).style({opacity:1})},_create_update_focusPoint:function(e){var t=this,n="focusPoint"+e,a=t.svg[n],i=function(){return t.dataPoint.color};a||(a=t.svg[n]=t.svg.append("circle").style({visibility:t.chart.hoverItemsVisible?"visible":"hidden","pointer-events":"all"}).attr({cx:0,cy:0,r:3}),t.addFocusPointEvent(a),t.hoverItems.push(a)),a.attr({fill:i})},_render_focusPoint:function(e,t){var n=this,a=n.chart.axisX.scale(),i=n.scale(),r=n.svg,o=n.overPoint,s=r&&r["focusPoint"+e];if(s)if(o){var l=r.xFocusScale?r.xFocusScale(o):a(o.time),c=i(o.val[t]);s.attr({cx:l,cy:c})}else s.style("visibility","hidden")},_render_area:function(){function e(e){var t=i.chart.axisX.scale();return t(e.time)}function t(e){var t=i.scale();return t(e.val.max)}function n(e){var t=i.scale();return t(e.val.min)}function a(){return i.dataPoint.color}var i=this,r=i.getLineType()||"linear",o=d3.svg.area().interpolate(r).x(e).y0(t).y1(n),s=i.svg._path;s||(s=i.svg._path=i.svg.append("path").style({"pointer-events":"none",opacity:.8})),i._create_update_focusPoint(1),i._create_update_focusPoint(2),s.attr("d",function(){return o(i.values)}).style({"pointer-events":"none",stroke:a,fill:a}),_.includes(["points","linePoints"],i.getLineType())?(i.svg.selectAll("circle.point.max").data(i.values).enter().append("circle").attr("class","point max"),i.svg.selectAll("circle.point.min").data(i.values).enter().append("circle").attr("class","point min"),i.svg.selectAll("circle.point.max").attr("cx",e).attr("cy",t).attr("r",4).attr("fill","transparent").attr("stroke",a),i.svg.selectAll("circle.point.min").attr("cx",e).attr("cy",n).attr("r",4).attr("fill","transparent").attr("stroke",a)):i.svg.selectAll("circle.point").remove()},onMove:function(e,t){var n=this,a=n.getNearIndex(e);n.hover(a,e,t)},hoverValue:function(){var e=this,t=e.getRenderType(),n=e.overPoint,a=e.dataPoint.unit||"",i=" -- ";if(n){var r=n.val.min,o=n.val.max;"min"===t&&(i=r+" "+a),"max"===t&&(i=o+" "+a),"area"===t&&(i=r+" - "+o+" "+a)}return i},hoverTime:function(){var e=this,t=e.overPoint,n=t?moment(t.time).format(h):"--";return n},getNearIndex:function(e){var t=this,n=e,a=t.values,i=1,r=a.length-1,o=t.bisect(a,e,i,r),s=a[o-1]&&a[o-1].time,l=a[o]&&a[o].time;return _.isUndefined(s)?o:_.isUndefined(l)?o-1:n-s<l-n?o-1:o},measurementFits:function(e){var t=this,n=s.rtMeasurementForDatapoint(t.dataPoint);return n(e)},addFocusPointEvent:function(e){var t=this,n=t.chart;e.on("click",function(){if(n.allowSelectFocusTime){var e=(t.dataPoint.__target||{}).id,a={target:e,date:moment(t._focusPointTime).format("YYYY-MM-DDTHH:mm:ss.SSSZ")},i=n.selectedPoint;return i&&moment(a.date).isSame(moment(i.date))?void n.clearSelectPoint():void n.setSelectPoint(a)}}),e.on("mouseenter",function(){n.allowSelectFocusTime&&e.style({cursor:"pointer"}).attr({r:6})}),e.on("mouseleave",function(){n.allowSelectFocusTime&&e.style({cursor:"default"}).attr({r:3})})},realtimeMeasurement:function(e){var t=this,n=t.measurementFits(e);return n&&(t.__realtimeToAppend||(t.__realtimeToAppend=[]),t.__realtimeToAppend.push(n.values)),t.__realtimeToAppendTimout||(t.__realtimeToAppendTimout=setTimeout(function(){t.appendValues(_.flattenDeep(t.__realtimeToAppend)),t.__realtimeToAppend=[],t.__realtimeToAppendTimout=void 0,t.chart.render()},250)),n}},m.prototype={scale:function(){var e=this,t=e.chart.box();return d3.time.scale().domain([e._from,e._to]).range([t.rangeMin,t.rangeMax])},axis:function(){var e=this;return d3.svg.axis().scale(e.scale()).orient("bottom").ticks(6).tickFormat(v)},canRender:function(){var e=this;return!(!e._from||!e._to)},updateDates:function(e,t,n){var a=this;a._from=moment(e).toDate(),a._to=moment(t).toDate(),n&&a.onUpdateDates&&a.onUpdateDates(a._from,a._to),a._xDragStart||a.chart.render()},render:function(){var t=this,n=t.axis(),a=t.el,i=t.chart.box(),r=t.chart.margins,o=i.height-r.b;if(!a){var s=t.chart.svg;a=t.el=s.append("g").attr({class:"xaxis axis",transform:e(r.l,o)}).style({"pointer-events":"all",cursor:"ew-resize"}),a.boxHover=a.append("rect").attr({class:"recthover",height:19,fill:"rgba(255,255,255,0.01)",transform:e(r.l,0)});var l=t.drag=d3.behavior.drag();a.call(l),a.boxHover.call(l),t.addEvents()}a.boxHover.attr("width",function(){return t.chart.box().axisXwidth}),t.canRender()&&a.call(n).attr({transform:e(r.l,o)})},onMouseDown:function(){var e=this;return function(){d3.event.sourceEvent.stopPropagation();var t=e._scale=e.scale();e._xDragStart=t.invert(d3.mouse(e.el.node())[0]),e.__from=e._from,e.__to=e._to,e.el.select("path").style("stroke","#CCC")}},onDragEnd:function(){var e=this;return function(){d3.event.sourceEvent.stopPropagation(),_.isUndefined(e._xDragStart)||(e.chart.render(),e.el.select("path").style("stroke",""),e.onUpdateDates&&(e.onUpdateDates(e._from,e._to),n.$apply())),delete e._xDragStart}},updateScaleOnDrag:function(e){var t=this,n=t._scale,a=moment(n.invert(e)),i=a.diff(t._xDragStart);t.updateDates(moment(t.__from).subtract(i,"ms"),moment(t.__to).subtract(i,"ms")),t.render()},onDrag:function(){var e=this;return function(){d3.event.sourceEvent.stopPropagation();var t=e.el.node();_.isUndefined(e._xDragStart)||e.updateScaleOnDrag(d3.mouse(t)[0])}},addEvents:function(){var e=this;e.drag.on("dragstart",e.onMouseDown()).on("drag",e.onDrag()).on("dragend",e.onDragEnd())}},f.prototype={indexPosition:function(){var e=this,t=e.chart.getAxisY();return t.indexOf(e)},indexPositionInSide:function(){var e=this,t=e.orientation(),n=e.chart.getAxisYByOrientation(t);return n.indexOf(e)},orientation:function(){var e=this,t=e.firstSeries(),n=t.dataPoint;return n.yAxisType||e.autoOrientation()},autoOrientation:function(){var e=this,t="left",n=e.chart.getAxisY(),a=n.indexOf(e),i=_.findIndex(n,function(t){var n=t.firstSeries().dataPoint.yAxisType;return t!==e&&(!n||"left"===n)});return i>-1&&i<a&&(t="right"),t},addSerie:function(e){this.series.push(e)},firstSeries:function(){var e=this;return e.series[0]||{dataPoint:{}}},axis:function(){var e=this,t=d3.format(".2s"),n=function(e){return String(e).length>4?t(e):e};return d3.svg.axis().scale(e.scale()).orient(e.orientation()).ticks(6).tickFormat(n)},scale:function e(){var e,t=this,n=t.series[0];return n&&(e=n.scale()),e},remove:function(){var e=this;e.chart.removeItem(e),e.el&&e.el.remove()},render:function(){var n=this,a=n.axis(),i=n.el,r=n.chart.box(),o=n.chart.margins,s=n.chart.sizes.yAxisWidth,l=o.t,c=n.orientation(),u=n.indexPositionInSide()+1,d="left"===c,m=u*s,f=d?o.l+m:r.width-o.r-m,p=e(f,l);if(!i){var v=n.chart.svg;n._id="axis"+String(Math.random()).substr(2),i=n.el=v.append("g").attr({class:"yaxis axis",id:n._id}),n.label=i.append("text").style({fill:"#999","font-size":"10px"})}var h=d?-35:35,g=r.height/2,_=d?-90:90;n.label.attr({x:h,y:g,"text-anchor":"middle",transform:t(_,h,g)}),n.label.text(n.labelText()),i.attr("transform",p),i.call(a),n.renderCircles()},renderCircles:function(){var e=this,t=e.chart,n=e.el,a=e.series,i="right"===e.orientation()?35:-35,r=t.box(),o=t.margins,s=r.height-o.t-o.b;n.selectAll("circle").remove(),_.forEach(a,function(e,t){var a=e.dataPoint;n.append("circle").attr({cx:i,cy:s-7*t,r:5,fill:function(){return a.color}})})},labelText:function(){var e=this,t="",n=e.series;if(1===n.length){var a=n[0].dataPoint;t=a.label+(a.unit?" ["+a.unit+"]":"")}else t=_.uniqBy(_.filter(_.map(n,function(e){return e.dataPoint.unit}),_.identity)).join(" / ");return t}},p.prototype={tplMain:$('<div class="c8y-chart-hover-box"></div>'),tplTime:$('<div class="clock"><i class="fa fw fa-clock-o"></i><span class="time"></span></div>'),tplRow:$('<div class="series"><div class="value-holder"><i class="fa fw fa-circle"></i><span class="label"></span><span class="value"></span></div><div class="time-holder"><i class="fa fw fa-clock-o"></i><span class="time"></span></div></div>'),init:function(){var e=this,t=$("body"),n=e.el=$("<div>").append(e.tplMain.clone()).find(".c8y-chart-hover-box");e.el.append(e.tplTime.clone()),e.clock=n.find(".clock .time"),e.el.hide(),t.append(n),e.mouseMove=function(t){e._mx=t.pageX,e._my=t.pageY},e.chart.el.on("mousemove",e.mouseMove)},destroy:function(){this.el.remove()},render:function(e){var t=this,n=t.chart.series,a=t.el;if(!a.is(":hidden")){if(e){var i=moment(e).format(h);t.clock.text(i)}_.forEach(n,function(e){var n=e._hoverRow;if(!n){var i=t.tplRow.clone(),n=e._hoverRow={el:i,circle:i.find(".fa-circle"),label:i.find(".label"),value:i.find(".value"),time:i.find(".time")};i.data("seriedata",e),a.append(i)}n.circle.css({color:e.dataPoint.color}),n.label.text(e.dataPoint.label),n.value.text(e.hoverValue()),n.time.text(e.hoverTime())}),a.find(".series").filter(function(){return!_.includes(n,$(this).data("seriedata"))}).remove()}},onMove:function(e,t,n){var a=this,i=a.chart;if(_.get(i,"selectedPoint.date")&&!i.mouseIn){var r=$(i.el).offset();a._mx=r.left+t+10,a._my=r.top}var o=a.el.width(),s=i.box().width,l=i.margins,c=t+l.l,u=c+o>s,d=window.scrollY+window.innerHeight,m=this.el.outerHeight(),f="auto",p=u?-($("body").width()-a._mx):a._mx+1,v=a._my+20;v+m>d&&(v=d-m);var h={left:u?f:0,right:u?0:f,transform:"translate("+p+"px,"+v+"px)"};a.render(e),a.el.css(h)}},{Chart:u,renderTypes:g,lineTypes:y,axisTypes:x}}n.$inject=["$rootScope","$q","$timeout","c8yBase","c8yLocales","c8yMeasurements","gettext"],angular.module("c8y.core.measurements2").factory("c8yChart",n)}(),function(){"use strict";function e(e){return{restrict:"E",link:function(t,n,a,i){var r=new e.Chart(n,{showTime:t.showTime()});i.init(r),t.$on("$destroy",function(){r.destroy()})},controller:"c8yChartCtrl",controllerAs:"ctrl",templateUrl:"core_measurements/measurements2/chart.html",scope:{dateFrom:"=?",dateTo:"=?",aggregation:"=?",realtime:"=?",datapoints:"=",datapointsInitialDisplayLimit:"<",onData:"=?",onUpdateDates:"&",onUpdateDisplayedDates:"&",onBoxChanged:"&",showTime:"&",selectable:"&",selected:"=?",onDataChange:"&",appendDatepickerToBody:"<?"}}}angular.module("c8y.core.measurements2").directive("c8yChart",["c8yChart",e])}(),function(){"use strict";function e(e,t,n,a){function i(){b&&T.dateFrom&&T.dateTo&&(S=!0,b.loadData(T.dateFrom,T.dateTo,e.aggregation).then(o).finally(function(){S=!1,e.onDataChange({chart:b})}))}function r(t){var n=b.realtimeMeasurement(t);n&&(s(),o(),e.selectable()&&(l(x),e.selected&&b.setSelectPoint(e.selected)))}function o(){x=moment()}function s(){!S&&moment().diff(x)>y&&i()}function l(e,t){var n=t||{},a=moment(e),r=moment.duration(moment(T.dateTo).diff(T.dateFrom)),o=moment(a).subtract(r);T.dateFrom=o.toDate(),T.dateTo=a.toDate();var s=T,l=s.dateFrom,c=s.dateTo;n.notrigger&&(D=!0),b.axisX.updateDates(l,c,!1),n.loadData&&i()}function c(e){e&&(F[e]=!0),_.every(F,function(e){return e===!0})&&g()}function u(){s(),moment(b.axisX._to).isBefore(moment())&&!b.allowSelectFocusTime&&l(moment(),{notrigger:1})}function d(a){b=a,e.chart=b,T={},e.internalDates=T,w=n(u),b.axisX.onUpdateDates=function(e,t){T.dateFrom=e,T.dateTo=t},e.$watch("dateFrom",function(t){e.internalDates.dateFrom=new Date(t),b.axisX.updateDates(t,e.dateTo,!1),c("dateFrom")}),e.$watch("dateTo",function(t){e.internalDates.dateTo=new Date(t),b.axisX.updateDates(e.dateFrom,t,!1),c("dateTo")}),e.$watch("internalDates",function(t,n){if(e.dateError=t.dateFrom>t.dateTo,!e.dateError)return e.onUpdateDisplayedDates&&e.onUpdateDisplayedDates({$dateFrom:t.dateFrom,$dateTo:t.dateTo}),D?void(D=!1):void(t!==n&&e.onUpdateDates&&e.onUpdateDates({$dateFrom:t.dateFrom,$dateTo:t.dateTo}))},!0),e.$watch("aggregation",function(){return c("aggregation")}),e.$watch("datapoints",function(){b.updateSeries(_.filter(e.datapoints,"__active"),!1),m()},!0),e.$watchCollection("datapoints",function(){return c("datapoints")}),e.$watch("realtime",function(t){return!t||e.selectable()?void w.cancel():(l(moment(),{notrigger:1,loadData:1}),void w.start())}),e.$watch("selected",function(e){e?b.setSelectPoint(e):b.clearSelectPoint()}),b.onSelectPoint=function(n){t(function(){e.selected=n})},e.$watch(function(){return e.selectable()},function(e){b.allowSelectFocusTime=e,e&&w.cancel()}),e.$watch("chart.chartBox",function(t,n){_.isEqual(t,n)||e.onBoxChanged({box:t})});var i=_.throttle(b.render.bind(b),500);e.$on("dashboardResize",function(){return i()}),e.$watch("showTime()",function(e){e?b.showDateSelection():b.hideDateSelection()}),e.onData=r,e.$on("$destroy",function(){return w.cancel()}),e.onSeriesSelectionChanged=v}function m(){e.seriesAvailable=f(),v(e.seriesSelected?_.filter(e.seriesAvailable,"datapointActive"):p())}function f(){return _.map(e.datapoints,function(e,t){return{id:t,name:e.label,datapoint:e,datapointActive:e.__active}})}function p(){var t=_.filter(f(),"datapointActive"),n=e.datapointsInitialDisplayLimit;return _.isUndefined(n)?t:_.take(t,n)}function v(t){e.seriesSelected=t;var n=_.map(e.seriesSelected,"datapoint");b.updateSeries(n,!0)}var h=this,g=_.debounce(i,300,{leading:!1,trailing:!0}),y=12e4,x=void 0,b=void 0,T=void 0,w=void 0,D=void 0,S=!1,k=a("Realtime is active. Deactivate it to edit date and time."),F={dateFrom:!1,dateTo:!1,aggregation:!1,datapoints:!1};h.init=d,e.data={},e.realtimeActiveInfo=k}e.$inject=["$scope","$timeout","RTAutoMove","gettext"],angular.module("c8y.core.measurements2").controller("c8yChartCtrl",e)}(),function(){"use strict";function e(e){function t(){!r&&i.length&&(r=e(function(){return _.forEach(i,function(e){return e()})},a))}function n(){!i.length&&r&&(e.cancel(r),r=void 0)}var a=1e3,i=[],r=void 0;return function(e){return{start:function(){i.push(e),t()},refresh:_.noop,cancel:function(){_.pull(i,e),n()}}}}e.$inject=["$interval"],angular.module("c8y.core.measurements2").factory("RTAutoMove",e)}(),function(){"use strict";function e(){return{restrict:"E",templateUrl:"core_measurements/views/iconBar.html",scope:{realtime:"=",aggregation:"=",showAggregation:"=",showLoading:"=",showRealtime:"=",showTruncated:"="},controller:["$scope","gettext",function(e,t){var n={undefined:t("No aggregation"),MINUTELY:t("Minutely aggregation"),HOURLY:t("Hourly aggregation"),DAILY:t("Daily aggregation")},a={undefined:"line-chart",MINUTELY:"spinner",HOURLY:"clock-o",DAILY:"calendar-o"};e.getRealtimeIconName=function(){return e.realtime?"check-circle-o":"circle-o"},e.getRealtimeIconText=function(){return t(e.realtime?"Realtime active":"Realtime inactive")},e.getRealtimeClassName=function(){return e.realtime?"text-success":""},e.getAggregationIconName=function(){return a[e.aggregation]},e.getAggregationIconText=function(){return n[e.aggregation]}}]}}angular.module("c8y.core.measurements2").directive("c8yMeasurementsIconBar",e)}(),function(){"use strict";function e(e,t,n){function a(){m.dateFrom=moment().subtract(1,"hour").toDate(),m.dateTo=new Date}function i(){m.device&&m.fragment&&(d=e.getId(m.device),r(),o())}function r(){m.channel="/measurements/"+d}function o(){var n={source:d,fragmentType:m.fragment,pageSize:100,dateFrom:null,dateTo:moment().add("day",1).format(e.dateFullFormat)};return t.list(n).then(s).then(l).then(_.partial(_.set,m,"dataPoints"))}function s(e){return _.reduce(e,function(e,t){return _.assign(e,_.get(t,m.fragment))},{})}function l(t){var n=0,a=m.fragment,i={__target:{id:d},fragment:a,lineType:"line",renderType:"area"};return _.map(t,function(t,r){return _.assign({series:r,unit:t.unit,label:e.humanizeFragment(a+" => "+r),color:f(n++),__active:!0},i)})}function c(e,t){m.dateFrom=e,m.realtime&&t<=new Date&&(m.realtime=!1),m.dateTo=t}function u(e){_.forEach(e.series,function(e){var t=e.dataPoint,n=_.find(m.dataPoints,function(e){return e.fragment===t.fragment&&e.series===t.series});if(n){var a=e.values,i=_.min(a,_.property("val.min")),r=_.max(a,_.property("val.max"));i===r&&(i-=1,r+=1),n.min=i,n.max=r}})}var d,m=this,f=d3.scale.category10();m.aggregation="MINUTELY",m.interval=n._defaultDuration,_.assign(m,{$onChanges:i,$onInit:a,onUpdateDates:c,updateScale:u})}e.$inject=["c8yBase","c8yMeasurements","INTERVAL_CONSTANTS"],angular.module("c8y.core.measurements2").component("c8yMeasurementsFragmentChart",{templateUrl:"core_measurements/fragmentChart/fragmentChart.html",controllerAs:"vm",controller:e,bindings:{fragment:"<",device:"<",dateFrom:"=",dateTo:"=",realtime:"=?",hideRealtimeButton:"=?"}})}(),function(){"use strict";function e(e){var t;t='<div class="data-point-explorer fragment-chart">\n  <div class="form-inline form-group-sm realtime-form">\n    <span class="hidden-xs" translate>Aggregation</span>\n    <c8y-aggregation date-from="vm.dateFrom" date-to="vm.dateTo" aggregation="vm.aggregation" realtime="vm.realtime" auto="true">\n    </c8y-aggregation>\n\n    <c8y-interval date-from="vm.dateFrom" date-to="vm.dateTo" interval="vm.interval">\n    </c8y-interval>\n    <c8y-realtime-button ng-hide="vm.hideRealtimeButton" class="text-gray-medium-dark" channel="{{vm.channel}}" state="vm.realtime" on-data="vm.onData($data)">\n    >\n    </c8y-realtime-button>\n  </div>\n\n  <div class="c8yGraphFill has-aggregation" style="height:400px; clear: both">\n      <c8y-chart datapoints="vm.dataPoints" date-from="vm.dateFrom" date-to="vm.dateTo" realtime="vm.realtime" aggregation="vm.aggregation" show-time="true" on-data="vm.onData" on-data-change="vm.updateScale(chart)" on-update-dates="vm.onUpdateDates($dateFrom, $dateTo)">\n      </c8y-chart>\n  </div>\n</div>\n',e.put("measurements/fragmentChart/fragmentChart.html",t),e.put("core_measurements/fragmentChart/fragmentChart.html",t),e.put("/apps/core/measurements/fragmentChart/fragmentChart.html",t),t='<div class="top-chart-bar flex-row wrap" ng-class="{\'showtime\': showTime(), \'has-data-selector\': $parent.child.templateUrl }">\n\n  <!-- icon bar -->\n  <c8y-measurements-icon-bar class="measurement-icon-bar-wrapper" aggregation="aggregation" realtime="realtime" show-aggregation="true" show-loading="chart.loading" show-realtime="true" show-truncated="chart.truncated" style="position: static">\n  </c8y-measurements-icon-bar>\n\n  <!-- datapoints selection -->\n  <c8y-item-selector items="seriesAvailable" items-selected="seriesSelected" on-apply="onSeriesSelectionChanged(items)" text-apply="{{\'Apply\' | translate}}" text-placeholder="{{\'Select data points\' | translate}}">\n  </c8y-item-selector>\n\n  <!-- datetime selection -->\n  <!-- be careful here, if you use ng-if, it will create a new scope.\n       ng-model for dates will break because we are not obeying\n       the dot rule due to shortcoming of angular 1.2 (lack of\n       bindToController directive option).\n       @TODO: Now this option should be available. Try to fix it when feasible.\n  -->\n  <div class="measurements-time-control" ng-show="showTime()">\n    <div class="measurements-date-from" uib-tooltip="{{realtime ? (realtimeActiveInfo | translate) : undefined}}" tooltip-append-to-body="{{realtime ? \'true\' : undefined}}" tooltip-placement="{{realtime ? \'bottom\' : undefined}}">\n      <label class="small right-m-xs" translate>From`date`</label>\n      <div class="date-time-picker">\n        <div class="form-group datepicker pull-left" style="margin-right:5px">\n          <input class="form-control input-sm" placeholder="{{\'From`date`\' | translate}}" style="width:100px; text-align:center" is-open="openFrom" uib-datepicker-popup popup-placement="auto bottom" mousewheel="false" datepicker-append-to-body="{{appendDatepickerToBody}}" show-button-bar="false" datepicker-options="{maxDate: internalDates.dateTo}" ng-model="internalDates.dateFrom" ng-click="openFrom=true" ng-disabled="realtime">\n        </div>\n        <div class="form-group input-sm rightAlignCalendar timeField pull-left">\n          <div uib-timepicker mousewheel="false" ng-model="internalDates.dateFrom" show-meridian="false" show-spinners="false" ng-disabled="realtime"></div>\n        </div>\n      </div>\n    </div>\n\n    <div class="measurements-date-to" uib-tooltip="{{realtime ? (realtimeActiveInfo | translate) : undefined}}" tooltip-append-to-body="{{realtime ? \'true\' : undefined}}" tooltip-placement="{{realtime ? \'bottom\' : undefined}}">\n      <label class="small right-m-xs" translate>To`date`</label>\n      <div class="date-time-picker">\n        <div class="form-group datepicker rightAlignCalendar pull-left" style="margin-right:5px">\n          <input class="form-control input-sm" placeholder="{{\'To`date`\' | translate}}" style="width:100px;text-align:center" is-open="openTo" uib-datepicker-popup popup-placement="auto bottom" mousewheel="false" datepicker-append-to-body="{{appendDatepickerToBody}}" show-button-bar="false" on-open-focus="false" datepicker-options="{minDate: internalDates.dateFrom}" ng-model="internalDates.dateTo" ng-click="openTo=true" ng-disabled="realtime">\n        </div>\n        <div class="form-group input-sm rightAlignCalendar timeField pull-left">\n          <div uib-timepicker mousewheel="false" ng-model="internalDates.dateTo" show-meridian="false" show-spinners="false" ng-disabled="realtime"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<hr>\n\n\n\n<div class="chart-container"></div>\n',e.put("measurements/measurements2/chart.html",t),e.put("core_measurements/measurements2/chart.html",t),e.put("/apps/core/measurements/measurements2/chart.html",t),t='<div class="measurement-icon-bar clearfix">\n  <div class="inner-alert" ng-show="showTruncated">\n    <div class="alert alert-warning">\n      <p><strong translate>Truncated data.</strong>\n        <translate>Change aggregation or select shorter date range.</translate>\n      </p>\n    </div>\n  </div>\n\n  <span ng-show="showRealtime" class="measurement-icon c8y-realtime asurement-realtime {{ getRealtimeClassName() }}" tooltip-placement="right" tooltip-append-to-body="true" uib-tooltip="{{ getRealtimeIconText() | translate }}">\n    <!-- TODO: Fix hack\n      change the function getRealtimeIconName to return \'active : inactive \' instead of icon name\n    -->\n    <span class="c8y-pulse" ng-class="{active:getRealtimeIconName() == \'check-circle-o\', inactive:getRealtimeIconName() != \'check-circle-o\'}"></span>\n  </span>\n\n  <span ng-show="showAggregation" class="measurement-icon measurement-aggregation">\n    <i c8y-icon="{{ getAggregationIconName() }}" uib-tooltip="{{ getAggregationIconText() | translate}}" tooltip-placement="right" tooltip-append-to-body="true"></i>\n  </span>\n\n\n  <a tabindex="0" class="btn-help" uib-popover-html="\'Drag X-Axis to move time.<br>Select time period to zoom.<br>Double click to zoom out.\' | translate" popover-append-to-body="true" popover-placement="right" popover-trigger="\'focus\'">\n    <i class="fa fa-question-circle-o"></i>\n  </a>\n\n  <span ng-show="showLoading" class="measurement-icon measurement-loading">\n    <i c8y-icon="circle-o-notch" class="fa-spin" uib-tooltip="{{\'Loading\' | translate}}&hellip;" tooltip-placement="bottom" tooltip-append-to-body="true"></i>\n  </span>\n\n</div>',e.put("measurements/views/iconBar.html",t),e.put("core_measurements/views/iconBar.html",t),e.put("/apps/core/measurements/views/iconBar.html",t),t='<div ng-controller="measurementsCtrl">\n  <div ng-repeat="m in supportedMeasurements" ng-init="filters[$index] = {}">\n    <div c8y-measurement-line-chart measurement-type="{{m}}" device-id="{{deviceId}}" data-date-from="filters[$index].dateFrom" data-date-to="filters[$index].dateTo"></div>\n  </div>\n</div>\n',e.put("measurements/views/index.html",t),e.put("core_measurements/views/index.html",t),e.put("/apps/core/measurements/views/index.html",t),t='<div class="panel panel-clean">\n  <div class="panel-heading clearfix" ng-hide="hideHeader">\n\n    <div class="pull-right clearfix">\n      <c8y-realtime-button class="pull-right" ng-style="{display: hideRealtime ? \'none\': \'\'}" on-data="onData($data)" start="startRealtime" state="realtimeState" channel="/measurements/{{deviceId}}"></c8y-realtime-button>\n\n      <c8y-time-interval class="pull-right" ng-hide="hideRealtime" date-from="filter.dateFrom" date-to="filter.dateTo" interval="filter.interval" interval-description="intervalDescription" hide-selector="hideTimeSelector" on-datepicker-open="onDatepickerOpen(isOpen)">\n      </c8y-time-interval>\n\n      <div class="pull-right form-group">\n        <select class="form-control" ng-hide="hideTimeSelector" ng-model="selectedAggregationTypeValue" ng-change="onAggregationTypeChangedManually(selectedAggregationTypeValue)">\n          <option ng-repeat="aggregationType in aggregationTypes" value="{{aggregationType.value}}" ng-disabled="!isAggregationTypeEnabled(aggregationType)">\n            {{aggregationType.name | translate}}\n          </option>\n        </select>\n      </div>\n\n      <i c8y-icon="spinner" class="fa-spin fa-lg loadingIcon pull-right" style="margin-top:9px; margin-right:5px; display:none"></i>\n    </div>\n    <h3 class="panel-title" style="line-height:34px">{{title}}</h3>\n\n  </div>\n  <div class="panel-body">\n\n    <div ng-show="hideHeader">\n      <div class="pull-right">\n        <i c8y-icon="spinner" class="fa-spin fa-lg loadingIcon" style="display:none"></i>\n        {{intervalDescription | translate}} ({{aggregationTypeDescription | translate}})\n        <button type="button" class="btn btn-xs btn-default" ng-click="getData()">\n          <i c8y-icon="refresh"></i>\n        </button>\n      </div>\n    </div>\n\n    <div class="alert alert-warning" ng-show="series.length == 0" style="clear:both" translate>\n      No data available.\n    </div>\n\n    <div class="alert alert-warning" ng-show="(truncated || series.truncated) && series.length > 0" style="clear:both" translate>\n      Data has been truncated. Please use aggregation.\n    </div>\n\n    <div class="graph" ng-hide="!series || series.length == 0" style="margin-top:10px"></div>\n    <div class="graphHoverInfoCurrent" ng-show="showHover">\n      <div class="currentTime">{{currentTime | date : \'MMM d, y HH:mm:ss\'}}</div>\n    </div>\n    <div class="graphHoverInfo" ng-show="showHover">\n      <h4 class="seriesTitle" translate>Nearest measurement:</h4>\n      <span class="nearTime" ng-show="nearTime">{{nearTime | date : \'MMM d, y HH:mm:ss\'}}</span>\n      <div ng-repeat="s in series">\n\n        <div class="colorbox" ng-style="{\'background-color\': s.kpi.color || s.color}"></div>\n        <span class="name">{{s.kpi.label || s.name}}:</span>\n        <span ng-show="s.nearValue.min === s.nearValue.max">\n          <span class="value">{{s.nearValue.min}}</span>\n          <span class="unit">{{s.kpi.unit || s.unit}}</span>\n        </span>\n        <span ng-show="s.nearValue.min !== s.nearValue.max">\n          <span class="value">{{s.nearValue.min}}</span>\n          <span class="unit">{{s.kpi.unit || s.unit}}</span>\n          &ndash;\n          <span class="value">{{s.nearValue.max}}</span>\n          <span class="unit">{{s.kpi.unit || s.unit}}</span>\n        </span>\n        <span class="nearTime" style="display:block;clear:left;font-size:11px;margin-bottom:3px;color:#AAA" ng-hide="nearTime">{{s.nearTime | date : \'MMM d, y HH:mm:ss\'}}</span>\n\n\n      </div>\n    </div>\n\n  </div>\n</div>\n',e.put("measurements/views/lineChart.html",t),e.put("core_measurements/views/lineChart.html",t),e.put("/apps/core/measurements/views/lineChart.html",t),t='<form class="form-inline">\n\n    <div class="form-group">\n      <div class="c8y-select-wrapper">\n        <select class="form-control" ng-hide="hideSelector" ng-options="(interval.txt | translate) for interval in timeIntervals" ng-model="selInterval" ng-change="onChange()">\n        </select>\n        <span></span>\n      </div>\n    </div>\n\n    <div class="form-group datepicker" ng-show="isCustom()">\n      <input class="form-control" placeholder="{{\'From`date`\' | translate}}" is-open="openFrom" uib-datepicker-popup datepicker-options="{maxDate: dateTo}" show-button-bar="false" ng-model="dateFrom" ng-click="openFrom=true">\n    </div>\n\n    <div class="form-group datepicker" ng-show="isCustom()">\n      <input class="form-control" placeholder="{{\'To`date`\' | translate}}" is-open="openTo" uib-datepicker-popup datepicker-options="{minDate: dateFrom}" show-button-bar="false" ng-model="dateTo" ng-click="openTo=true">\n    </div>\n\n    <button type="button" class="btn btn-link" ng-click="search(true)">\n      <i c8y-icon="refresh"></i> <translate>Reload</translate>\n    </button>\n\n</form>\n',e.put("measurements/views/timeInterval.html",t),e.put("core_measurements/views/timeInterval.html",t),e.put("/apps/core/measurements/views/timeInterval.html",t)}angular.module("c8y.core.measurements2").run(["$templateCache",e])}();