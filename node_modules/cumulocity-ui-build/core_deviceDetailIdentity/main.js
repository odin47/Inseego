/* core_deviceDetailIdentity 9.12.5 2018-08-27T16:54:01+00:00 b689bea882f7+ (release/9.12.0) tip */
angular.module("c8y.deviceDetailIdentity",[]).config(["c8yViewsProvider","c8ySearchProvider","gettext",function(e,t,n){"use strict";var i="core_deviceDetailIdentity/views/",a="/device/:deviceId";e.when(a,{templateUrl:i+"identity.html",priority:-1e3,name:n("Identity"),icon:"barcode",showIfPermissions:{anyRole:["ROLE_IDENTITY_READ","ROLE_IDENTITY_ADMIN"]}}),e.when("/identity",{template:"<div></div>",priority:1e4,controller:["$routeParams","$window","$location","c8yIdentity","c8yAlert","gettextCatalog",function(e,t,n,i,a,l){function d(){n.url("/device?text="+e.type+" "+e.externalId)}function r(t){var i=t.data,r=i.managedObject,o=r.id;o?(a.success(l.getString("Device found for identity {{type}}: {{externalId}}",e)),n.url("/device/"+o)):(a.danger(l.getString("Can't find managed for identity {{type}}: {{externalId}}!",e)),d())}e.type&&e.externalId?i.getExternalId(e).then(r,d):d()}]})}]),angular.module("c8y.deviceDetailIdentity").controller("deviceDetailIdentityCtrl",["$scope","$routeParams","c8yIdentity","c8yModal","c8yAlert","gettext","gettextCatalog",function(e,t,n,i,a,l,d){"use strict";function r(t){e.ids=t}function o(){s(),delete e.newId}function s(){return n.listExternalIds(h).then(r)}function c(e){i({title:l("Confirm delete?"),body:d.getString('Do you really want to remove the external identity "{{externalId}}" of the type {{idType}}?',{externalId:e.externalId,idType:e.type}),labels:{ok:l("Delete")},status:"danger"}).then(_.partial(n.deleteIdentity,e)).then(s).then(_.partial(a.success,l("External ID deleted")))}function y(t){var i=_.some(e.ids,{externalId:t.externalId,type:t.type});i?a.danger(d.getString("Cannot add new identity! Identity with type: {{type}} and external ID: {{externalId}} already exists.",t)):n.createIdentity(h,t).then(o).then(_.partial(a.success,l("External ID created")))}function p(){e.refreshLoading=!0,s().finally(function(){e.refreshLoading=!1})}function u(){e.newId={}}function v(){delete e.newId}var h=t.deviceId,I=l("The external ID is something that links the device information and the physical world (ex.: Serial Number, IMEI).\n\nIf for some reason the hardware needs to be replaced, so must the external ID be replaced with the appropriate information.\n\nWith this procedure the new hardware can continue linked to the information that was created by its predecessor");e.onClickDelete=c,e.create=y,e.paging={refresh:!0},e.refresh=p,e.add=u,e.cancel=v,e.helpText=I,s()}]),function(){"use strict";function e(e){var t;t='<div data-ng-controller="deviceDetailIdentityCtrl">\n\n  <c8y-ui-action-bar-set>\n    <li c8y-if-allowed any-role="[\'ROLE_IDENTITY_ADMIN\']">\n      <div class="dropdown" uib-dropdown auto-close="outsideClick" is-open="isOpen">\n        <button class="dropdown-toggle c8y-dropdown" uib-dropdown-toggle aria-haspopup="true" aria-expanded="false">\n          <span><i c8y-icon="plus-circle"></i> <translate>Add identity</translate></span>\n        </button>\n        <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>\n          <li class="dropdown-form">\n            <form role="form" name="newIdForm" class="panel-body" novalidate>\n              <div class="form-group">\n                <label translate>Type</label>\n                <input type="text" class="form-control" ng-model="newId.type" placeholder="{{\'e.g.\' | translate}} c8y_Serial" required>\n              </div>\n              <div class="form-group">\n                <label translate>External ID</label>\n                <input type="text" class="form-control" ng-model="newId.externalId" ng-maxlength="680" placeholder="{{\'e.g.\' | translate}} 4AB0123D0F" required>\n              </div>\n              <button class="btn btn-primary" ng-click="create(newId)" ng-disabled="newIdForm.$invalid" translate>Save</button>\n            </form>\n          </li>\n        </ul>\n      </div>\n    </li>\n\n    <c8y-refresh-btn></c8y-refresh-btn>\n  </c8y-ui-action-bar-set>\n\n\n  <div class="row">\n    <div class="col-md-8">\n      <div class="c8y-empty-state text-center" ng-show="ids.length === 0">\n        <h1 class="c8y-icon"><i c8y-icon="barcode"></i></h1>\n        <h3 translate>No external ids found</h3>\n      </div>\n      <div class="list-group">\n        <div class="list-group-item" ng-repeat="id in ids">\n          <div class="list-item-body">\n            <div class="row">\n              <div class="col-sm-4">\n                <label class="small" translate>Type</label> {{id.type}}\n              </div>\n              <div class="col-sm-6">\n                <label class="small" translate>External ID</label> {{id.externalId}}\n              </div>\n              <div class="col-sm-2 showOnHover text-right">\n                <c8y-if-allowed any-role="[\'ROLE_IDENTITY_ADMIN\']">\n                  <button class="btn btn-danger btn-xs" title="{{\'Delete identity\' | translate}}" data-ng-click="onClickDelete(id)">\n                    <i c8y-icon="trash"></i>\n                  </button>\n                </c8y-if-allowed>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="col-md-4">\n      <div class="card">\n        <div class="card-header">\n          <h4 class="card-title" translate>External ID</h4>\n        </div>\n        <hr>\n        <div class="card-block">\n          <p style="white-space: pre-wrap">{{helpText | translate}}</p>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>',e.put("deviceDetailIdentity/views/identity.html",t),e.put("core_deviceDetailIdentity/views/identity.html",t),e.put("/apps/core/deviceDetailIdentity/views/identity.html",t)}angular.module("c8y.deviceDetailIdentity").run(["$templateCache",e])}();