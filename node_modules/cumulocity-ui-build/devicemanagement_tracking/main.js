/* devicemanagement_tracking 9.12.5 2018-08-27T16:54:02+00:00 b689bea882f7+ (release/9.12.0) tip */
!function(){"use strict";function e(e,t){e.when("/device/:deviceId",{name:t("Tracking"),templateUrl:"devicemanagement_tracking/views/index.html",icon:"crosshairs",showIf:["$routeParams","c8yDevices",function(e,t){var n=e.deviceId;return t.detailCached(n).then(function(e){var t=e.data;return t&&t.c8y_Position})}]})}e.$inject=["c8yViewsProvider","gettext"],angular.module("c8y.parts.tracking",[]).config(e)}(),function(){"use strict";function e(e,t,n,a,i,c,r,o,s,l){function d(){g.hideAll();var e=g.dateFrom,t=g.dateTo;g.map.tracker.changeInterval({dateFrom:e&&moment(e).format(a.dateFullFormat),dateTo:t&&moment(t).format(a.dateFullFormat)}).then(function(){g.map.tracker.activate(g.deviceId,u)})}function m(){return g.map&&g.map.tracker&&g.map.tracker.loadMore&&g.map.tracker.loadMore[g.deviceId]}function v(){return s.detail(g.deviceId).then(a.getResData).then(l.gsmTrackingAvailable)}function p(){g.hideAll(),u={gps:"all"===g.trackingOption||"gps"===g.trackingOption,gsm:"all"===g.trackingOption||"gsm"===g.trackingOption},g.map.tracker.activate(g.deviceId,u)}var g=this;g.deviceId=t.deviceId;var u={gps:!0,gsm:!0},f=[{txt:c("Last hour"),time:"hour"},{txt:c("Last day"),time:"day"},{txt:c("Last week"),time:"week"},{txt:c("Last month"),time:"month"},{txt:c("Custom"),time:"custom"}];g.markers={},g.checkDateTo=function(){var e=moment(g.dateFrom);g.dateTo&&e.diff(moment(g.dateTo),"days")>=0&&(g.dateTo=e.clone().add("day",1).toDate())},g.toggle=function(e,t){if(g.markers["p"+e])g.map.leafletMap.removeLayer(g.markers["p"+e]),delete g.markers["p"+e];else{var a=i.getLocationFragment(t);a&&(g.markers["p"+e]=L.marker(L.latLng(a.lat,a.lng)).bindPopup(n("date")(t.time,"medium")).addTo(g.map.leafletMap))}},g.hideAll=function(){_.forEach(g.markers,function(e){g.map.leafletMap.removeLayer(e)}),g.markers={}},g.events=function(){var e=g.map&&g.map.tracker.events[g.deviceId];return _.filter(e,{type:"c8y_LocationUpdate"})},g.hasLoadMore=function(){return m()},g.loadMore=function(){var e=m();return e&&e()},g.markerTemplate=r.tracking.markerTemplate||null,g.realtime=r.tracking.realtime||!1,g.legend=r.tracking.legend||!1,g.eventText=r.tracking.eventText||!1,g.timeIntervals=f,g.onTrackingOptionChange=p,g.showTrackingOptions=!1,v().then(function(e){g.showTrackingOptions=e}),g.trackingOption="all",e.$on("search",d)}e.$inject=["$scope","$routeParams","$filter","c8yBase","c8yGeo","gettext","c8yConfig","c8yApplication","c8yDevices","c8yCombain"],angular.module("c8y.parts.tracking").controller("trackingCtrl",e)}(),function(){"use strict";function e(e,t,n,a,i,c,r){function o(t){e.geofence=t.c8y_Geofence&&t.c8y_Geofence.active,e.motion=t.c8y_MotionTracking&&t.c8y_MotionTracking.active||!1,e.radius=t.c8y_Geofence&&t.c8y_Geofence.radius||100}function s(t){return a.supportsOperation(e.device,t)}function l(){var n=[],i=e.device,c=i.id,o=i.c8y_Position;return e.geofence&&!o?void g(r("Device current position not defined")):(a.supportsOperation(i,"c8y_Geofence")&&n.push(v(c,o,e.radius,e.geofence)),a.supportsOperation(i,"c8y_MotionTracking")&&n.push(p(c,e.motion)),void(n.length?t.all(n).then(function(){e.$emit("message",{text:r("Operations created"),type:"success"})}):_.isUndefined(e.radius)||(d(i),m(i))))}function d(t){_.assign(t,{c8y_Radius:{value:e.radius}},{c8y_CopyPosition:_.cloneDeep(t.c8y_Position)})}function m(e){i.save(e).then(function(){c.success(r("Changes saved successfully!"))})}function v(e,t,a,i){var c=r(i?"Activate geofence":"Deactivate geofence");return n.create({deviceId:e,description:c,c8y_Geofence:{lat:t&&t.lat,lng:t&&t.lng,radius:a,active:!0}})}function p(e,t){var a=r(t?"Activate motion tracking":"Deactivate motion tracking");return n.create({deviceId:e,description:a,c8y_MotionTracking:{active:!!t}})}function g(t){e.$emit("message",{text:t,type:"error"})}e.supports=s,e.updateConfig=l;var u=e.$watch("device",function(e){e&&e.id&&(o(e),u())})}angular.module("c8y.parts.tracking").controller("trackingConfigCtrl",["$scope","$q","c8yDeviceControl","c8yDevices","c8yInventory","c8yAlert","gettext",e])}(),function(){"use strict";function e(e){var t;t='<div ng-controller="trackingCtrl as ctrl">\n\n  <c8y-ui-action-bar-set>\n    <c8y-realtime-btn-2 state="ctrl.map.state()" data-start-rt="ctrl.map.startRt()" data-stop-rt="ctrl.map.stopRt()"></c8y-realtime-btn-2>\n\n    <li class="navbar-form">\n      <form class="form-inline">\n        <div class="c8y-select-wrapper">\n          <select class="form-control" ng-model="ctrl.trackingOption" ng-change="ctrl.onTrackingOptionChange()" ng-if="ctrl.showTrackingOptions">\n            <option value="all" translate>Show all data</option>\n            <option value="gps" translate>Show GPS data only</option>\n            <option value="gsm" translate>Show GSM data only</option>\n          </select>\n          <span></span>\n        </div>\n        <c8y-time-interval date-from="ctrl.dateFrom" date-to="ctrl.dateTo"></c8y-time-interval>\n      </form>\n    </li>\n  </c8y-ui-action-bar-set>\n\n\n\n  <div class="row">\n\n    <div class="col-md-8">\n      <div class="card">\n        <div c8y-map-internal map="ctrl.map" marker-template="ctrl.markerTemplate" c8y-legend="ctrl.legend" device-id="ctrl.deviceId" style="margin-bottom:15px;height:500px" realtime="ctrl.realtime">\n        </div>\n      </div>\n    </div>\n    <div class="col-md-4">\n      <div class="card">\n        <div class="card-header">\n          <h4 class="card-title" translate>\n            Tracking events\n          </h4>\n        </div>\n        <hr>\n        <div class="card-block" ng-show="ctrl.events().length == 0">\n          <div class="c8y-empty-state text-left">\n            <h1 class="c8y-icon c8y-icon-location c8y-icon-duocolor"></h1>\n            <p>{{\'No tracking events found\' | translate}}</p>\n          </div>\n\n        </div>\n\n        <div class="card-inner-scroll" style="max-height:400px">\n          <div class="list-group">\n            <div class="list-group-item flex-row" ng-repeat="event in ctrl.events()" ng-class="{\'list-group-item-info\': !!ctrl.markers[\'p\'+$index]}" ng-click="ctrl.toggle($index, event)">\n              <div class="list-item-icon">\n                <i c8y-icon="c8y-location"></i>\n              </div>\n              <div class="list-item-body">\n                {{event.time|date:\'medium\'}}\n                 <span ng-if="ctrl.eventText"><br>{{event.text}}</span>\n              </div>\n            </div>\n          </div>\n          <a href="" class="btn btn-link btn-block" ng-click="ctrl.loadMore()" ng-show="ctrl.hasLoadMore()">{{\'Load more\' | translate}}</a>\n        </div>\n        <div class="card-footer" ng-show="ctrl.events().length">\n          <button type="button" class="btn btn-default" ng-click="ctrl.hideAll()">{{\'Deselect all markers\' | translate}}</button>\n        </div>\n      </div>\n\n    </div>\n  </div>\n</div>\n',e.put("tracking/views/index.html",t),e.put("devicemanagement_tracking/views/index.html",t),e.put("/apps/devicemanagement/tracking/views/index.html",t)}angular.module("c8y.parts.tracking").run(["$templateCache",e])}();