/* core_deviceGroupAssignment 9.12.5 2018-08-27T16:54:01+00:00 b689bea882f7+ (release/9.12.0) tip */
!function(){"use strict";function n(n,e){n.add({name:"deviceGroupAssignmentWidget",nameDisplay:e("Device group assignment"),description:e("Widget can assign device to selected group"),widgetComponent:"groupAssignment",options:{groupSelectable:!1}})}n.$inject=["c8yComponentsProvider","gettext"],angular.module("c8y.deviceGroupAssignment",[]).config(n)}(),function(){"use strict";function n(n,e,t,o,r,i,c,u,s,a,p,l,d,g){function m(){_.get(M.config,"device.id")&&(R=_.get(M.config,"device.id"),v(),h(),E())}function v(){return r.directParentAssets(R,k,B).then(f)}function f(n){M.currentGroups=n,r.clearBreadcrumbsCache(R),i.$emit("update")}function h(){return e.all([o.list({type:k}),o.list({fragmentType:B})]).then(_.flattenDeep).then(function(n){return _.uniqBy(n,function(n){return n.id})}).then(function(n){return _.filter(n,y)}).then(G)}function y(n){return n.id!==R}function G(n){O.length=0,n.forEach(function(n){O.push(n)})}function b(){var e=n.$new();t({templateUrl:"core/ui/views/deviceDetailBasic/groupSelectModal.html",controller:"c8yGroupSelectModalCtrl",scope:e}).then(function(n){M.group.selected=_.find(O,function(e){return e.id===n.id})})}function A(n){return w(n).then(function(n){return N(n)}).then(T)}function w(n){return C(n)?D(n.name):e.resolve(n)}function C(n){return!_.isUndefined(n.newGroup)}function D(n){return t({title:a("Confirm creation of the new group?"),body:d.getString("This will create a new group {{name}} and assign the device to it. Do you want to continue?",{name:n}),labels:{ok:a("Create and assign")},status:"warning",size:"sm"}).then(function(){return I({name:n})}).then(function(n){return $(n),n})}function I(n){return l.create(n).then(u.getResData)}function $(n){g.addGroupNavigation(n)}function N(n){return r.detailCached(R).then(function(e){var t=e.data;return o.addChildAsset(n,t)})}function T(){return v().then(function(){return c.success(a("Device added to group"))})}function x(n){return r.detailCached(R).then(function(e){var t=e.data;return s.unassignDevice(n,t)}).then(v).then(function(){return c.success(a("Device removed from group"))})}function E(){return p.hasAnyRole(["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"]).then(function(n){M.isCreateNewGroupAllowed=n})}var M=this,R=void 0,k="c8y_DeviceGroup",B="c8y_IsDeviceGroup",O=[];_.assign(M,{group:{},$onInit:m,availableGroups:O,searchGroupInHierarchy:b,addToGroup:A,removeFromGroup:x,isCreateNewGroupAllowed:!1})}function e(n,e,t,o,r){function i(){o.getTopLevelGroups().then(function(e){n.items=e}),n.breadcrumbs=s,n.currentManagedObjectId=n.device.id}function c(e){return t.detail(e).then(function(e){var t=e.data;return o.getGroupItems(t).then(function(e){n.items=e,s.push(t)})})}function u(n){for(;s[s.length-1]!==n;)s.pop();s.pop(),c(n.id)}var s=[];n.title=r("Choose group"),n.drillDown=c,n.upToGroup=u,n.select=e.close,n.dismiss=e.dismiss,n.isGroup=o.isGroup,i()}n.$inject=["$scope","$q","c8yModal","c8yInventory","c8yDevices","c8yBreadcrumbs","c8yAlert","c8yBase","groupsHierarchySvc","gettext","c8yPermissions","c8yDeviceGroup","gettextCatalog","groupTypesHierarchyNavigator"],e.$inject=["$scope","$uibModalInstance","c8yInventory","c8yGroups","gettext"],angular.module("c8y.deviceGroupAssignment").controller("GroupSelectModalCtrl",e).component("groupAssignment",{controller:n,controllerAs:"vm",templateUrl:"core_deviceGroupAssignment/groupAssignment.component.html",bindings:{config:"<"}})}(),function(){"use strict";function n(n){var e;e='<ul class="list-group bg-white">\n  <li class="list-group-item" ng-show="vm.currentGroups.length === 0">\n    <div class="c8y-empty-state text-left">\n      <h1 class="c8y-icon c8y-icon-group-open c8y-icon-duocolor"></h1>\n      <p>\n        <strong translate>Device not assigned.</strong><br>\n        <span translate>Assign the device to a group below.</span>\n      </p>\n    </div>\n  </li>\n  <li class="list-group-item word-break" ng-repeat="group in vm.currentGroups | orderBy:\'name\'">\n    <div class="pull-right showOnHover">\n      <button class="btn btn-warning btn-xs" ng-click="vm.removeFromGroup(group)" uib-tooltip="{{\'Unassign device\' | translate}}" tooltip-append-to-body="true">\n      <i c8y-icon="chain-broken"></i>\n    </button>\n    </div>\n    <a ng-href="#/group/{{group.id}}" class="text-gray-medium">\n      <i c8y-icon="c8y-group"></i> {{group.name}}\n    </a>\n  </li>\n</ul>\n\n<div class="card-block">\n  <div class="input-group top-m-sm">\n    <div c8y-device-group-selector group="vm.group.selected" allow-non-existing-group="vm.isCreateNewGroupAllowed" style="height:34px"></div>\n    <div class="input-group-btn">\n      <button class="btn btn-primary" ng-click="vm.addToGroup(vm.group.selected)" ng-disabled="!vm.group.selected" translate>\n        Assign\n      </button>\n    </div>\n  </div>\n</div>',n.put("deviceGroupAssignment/groupAssignment.component.html",e),n.put("core_deviceGroupAssignment/groupAssignment.component.html",e),n.put("/apps/core/deviceGroupAssignment/groupAssignment.component.html",e)}angular.module("c8y.deviceGroupAssignment").run(["$templateCache",n])}();