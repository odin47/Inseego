/* core_htmlWidget 9.12.5 2018-08-27T16:54:09+00:00 b689bea882f7+ (release/9.12.0) tip */
!function(){"use strict";function e(e,t){e.add({name:"Html widget",nameDisplay:t("HTML"),description:t("Display custom HTML code"),templateUrl:"core_htmlWidget/views/htmlWidget.html",configTemplateUrl:"core_htmlWidget/views/config.html",options:{groupsSelectable:!0}})}angular.module("c8y.parts.htmlwidget",[]).config(["c8yComponentsProvider","gettext",e])}(),function(){"use strict";function e(e,t){function n(){e.htmlCodeTooltipVisible=!e.htmlCodeTooltipVisible}e.htmlCodeTooltipVisible=!1,e.toggleHtmlCodeTooltip=n}angular.module("c8y.parts.htmlwidget").controller("htmlWidgetConfigCtrl",["$scope","gettext",e])}(),function(){"use strict";function e(e,t,n,i,l,c,o,s,a,r){function u(){return r.getSummary().then(function(t){e.devicesCount=t.data.deviceWithChildrenCount,e.variables.push(e.devicesCount)})}function d(){return c.mustHaveAnyRole(["ROLE_USER_MANAGEMENT_READ"]).then(t.list).then(function(t){e.usersCount=t.length,e.variables.push(e.usersCount)})}function h(){return n.list({pageSize:1e3}).then(function(t){e.onlineCount=_.filter(t,function(e){return i.isDeviceAvailable(e)}).length})}function v(){return l.list({fragmentType:"c8y_ActiveAlarmsStatus"}).then(function(t){e.criticalDevicesCount=_.filter(t,function(e){return e.c8y_ActiveAlarmsStatus&&e.c8y_ActiveAlarmsStatus.critical}).length,e.variables.push(e.criticalDevicesCount)})}function g(){return l.getCount({fragmentType:"c8y_IsDeviceGroup"}).then(function(t){e.deviceGroupsCount=t,e.variables.push(e.deviceGroupsCount)})}function m(e,t){return o.all({device:l.detail(e).then(s.getResData),children:t?n.listChildren(e):[]}).then(f)}function f(t){e.device=t.device,e.devices={},e.variables=[],e.devices[t.device.id]=t.device,_.forEach(t.children,function(t){e.devices[t.id]=t}),e.variables.push(e.device),e.variables.push(e.devices)}function p(){e.reloading=!0;var t=x("devices"),n=x("device")||t;return n?m(e.child.config.device.id,t).then(function(){e.reloading=!1}):(e.reloading=!1,o.when())}function b(t,n){!e.reloading&&e.device&&(w(n)?C(n):y(n))}function C(t){_.isEqual(t.childDevices,e.device.childDevices)&&_.isEqual(t.childAssets,e.device.childAssets)?(e.device=t,e.devices[t.id]=t):p()}function y(t){e.devices[t.id]=t}function w(t){return e.device.id===t.id}function T(){return"/managedobjects/*"}function W(){a.addListener(e.$id,T(),a.realtimeActions().UPDATE,b),a.start(e.$id,T())}function $(){a.stop(e.$id,T())}function A(){e.devices&&$(),e.device=null,e.devices=null}function D(e){return e.replace(new RegExp("\\s+","g"),"")}function x(t){var n=t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),i=new RegExp("\\s*\\b"+n+"\\b(\\s*|\\.|(\\[.*\\]))\\s*.*");return i.test(D(e.child.config.html))}function E(t){return D(e.child.config.html).indexOf("{{"+t+"}}")>-1}function H(){S(),A(),p().then(function(){W()})}function S(){var t=[];e.countersLoaded=!1,E("devicesCount")&&t.push(u()),E("deviceGroupsCount")&&t.push(g()),E("usersCount")&&t.push(d()),E("criticalDevicesCount")&&t.push(v()),E("onlineCount")&&t.push(h()),o.all(t).then(function(){e.countersLoaded=!0})}var L=this;_.assign(L,{isCustomVariableUsed:x}),e.$watch("child.config.device",function(e,t){e&&!_.isEqual(e,t)&&H()},!0),e.$watch("child.config.html",function(e,t){void 0===e||_.isEqual(e,t)||H()}),e.$on("$destroy",A),e.variables=[],H()}e.$inject=["$scope","c8yUser","c8yDevices","c8yDeviceStatus","c8yInventory","c8yPermissions","$q","c8yBase","c8yRealtime","c8yStatistics"],angular.module("c8y.parts.htmlwidget").controller("HtmlWidgetCtrl",e)}(),angular.module("c8y.parts.htmlwidget").directive("c8yHtmlWidget",["$compile","$sanitize",function(e,t){"use strict";function n(n,i){function l(l,c){l&&l!==c&&(n.child.config.unsafe?i.html(n.child.config.html):i.html(t(n.child.config.html)),e(i.contents())(n))}n.$watch("child.config.html",l),n.$watch("child.config.unsafe",function(){l(n.child.config.html)}),l()}return{restrict:"A",link:n}}]),function(){"use strict";function e(e){var t;t='<div ng-controller="htmlWidgetConfigCtrl" class="html-widget-config">\n  <div class="form-group">\n    <label translate>HTML code</label>\n    <button class="btn btn-link" ng-click="toggleHtmlCodeTooltip()" uib-tooltip="{{\'Toggle help text\' | translate}}">\n      <i c8y-icon="question-circle-o" ng-class="{\'text-primary\': !htmlCodeTooltipVisible, \'text-muted\': htmlCodeTooltipVisible}"></i>\n    </button>\n    <div class="alert alert-info text-left" ng-show="htmlCodeTooltipVisible">\n      <p translate>You can use the following variables in your HTML code:</p>\n      <ul>\n        <li>\n          <var ng-non-bindable>{{device}}</var> &ndash;\n          <translate>current device or group, you can access its properties e.g.</translate> <var ng-non-bindable>{{device.name}}</var>,\n        </li>\n        <li>\n          <var ng-non-bindable>{{devices}}</var> &ndash;\n          <translate>children of current device or group, you can access their properties e.g.</translate> <var ng-non-bindable>{{devices[14200].name}}</var>,\n        </li>\n        <li>\n          <var ng-non-bindable>{{devicesCount}}</var> &ndash;\n          <translate>number of devices</translate>,\n        </li>\n        <li>\n          <var ng-non-bindable>{{deviceGroupsCount}}</var> &ndash;\n          <translate>number of device groups</translate>,\n        </li>\n        <li>\n          <var ng-non-bindable>{{usersCount}}</var> &ndash;\n          <translate>number of users</translate>,\n        </li>\n        <li>\n          <var ng-non-bindable>{{criticalDevicesCount}}</var> &ndash;\n          <translate>number of devices with critical alarm status</translate>,\n        </li>\n        <li>\n          <var ng-non-bindable>{{onlineCount}}</var> &ndash;\n          <translate>number of online devices</translate>.\n        </li>\n      </ul>\n    </div>\n    <div class="checkbox">\n      <label>\n        <input type="checkbox" ng-model="config.unsafe"> {{\'Allow insecure use of elements and attributes\' | translate}}\n      </label>\n    </div>\n    <textarea class="form-control" ng-model="config.html" rows="10" required></textarea>\n  </div>\n</div>\n',e.put("htmlWidget/views/config.html",t),e.put("core_htmlWidget/views/config.html",t),e.put("/apps/core/htmlWidget/views/config.html",t),t='<div ng-controller="HtmlWidgetCtrl" c8y-html-widget>\n</div>\n',e.put("htmlWidget/views/htmlWidget.html",t),e.put("core_htmlWidget/views/htmlWidget.html",t),e.put("/apps/core/htmlWidget/views/htmlWidget.html",t)}angular.module("c8y.parts.htmlwidget").run(["$templateCache",e])}();