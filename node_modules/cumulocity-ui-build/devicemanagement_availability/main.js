/* devicemanagement_availability 9.12.5 2018-08-27T16:54:01+00:00 b689bea882f7+ (release/9.12.0) tip */
angular.module("c8y.parts.availability",["nvd3ChartDirectives"]).config(["c8yViewsProvider","c8yNavigatorProvider","c8yTitleProvider","gettext",function(a,t,i,e){"use strict";var n="signal",l="devicemanagement_availability/views/",r={name:e("Service monitoring"),icon:n,templateUrl:l+"detail.html",controller:"availabilityReportCtrl",showIfPermissions:{allRoles:["ROLE_ALARM_READ","ROLE_INVENTORY_READ"]}},o="availability";t.addNavigation({parent:e("Devices"),name:e("Service monitoring"),icon:n,path:o,showIfPermissions:{allRoles:["ROLE_ALARM_READ","ROLE_INVENTORY_READ"]}}),a.when("/device/:deviceId",_.cloneDeep(r)),a.when("/"+o,_.cloneDeep(r)),i.addTitle("/"+o,{data:function(){return{title:e("Service monitoring")}}})}]),function(){"use strict";function a(a,t,i,e,n,l){function r(){P.values().forEach(o)}function o(a){var t=c(a);return e.reports.downtimeDuration(t).then(function(i){return s(a,t,i.data)})}function c(a){var t=moment().add(1,"day"),e=moment().subtract(1,a.value),n=i.dateFullFormat;return{dateFrom:e.format(n),dateTo:t.format(n),id:k}}function s(a,t,i){var e=i.availabilityStats,n=v(t,i),l=e?e.reduce(function(a,t){return a+t.downtimeDuration},0):i.downtimeDuration,r=n-l;G[a.name]={name:a.name,label:a.label,order:a.ordinal,data:[{key:A.DOWNTIME.value,val:l},{key:A.UPTIME.value,val:r}]}}function v(a,t){var i=moment(a.dateFrom),e=moment(a.dateTo),n=e.diff(i,"seconds");return t&&t.availabilityStats&&(n*=t.availabilityStats.length),n}function d(){var a=i.dateFullFormat,t={dateFrom:moment().subtract(1,"month").format(a),dateTo:moment().add(1,"day").format(a)};return e.reports.downtimeDuration(t).then(function(a){return u(t,a.data)})}function u(t,i){var e=i.availabilityStats,n=v(t),l=e.map(function(a){var t=a.downtimeDuration;return a.percent=100*(n-t)/n,a});a.graphData=[{key:"operability",values:p(l)}]}function p(a){for(var t=10,i=100/t,e=[],n=function(a,t){return t.percent<=a&&t.percent>a-i},l=function(t){var l=t*i,r=a.filter(function(a){return n(l,a)}).length;e.push([l,r])},r=0;r<=t;r++)l(r);return e}function m(){return function(a){return a.key}}function h(){return function(a){return a.val}}function y(){return function(a){return a[0]}}function b(){return function(a){return a[1]}}function g(){return function(a){return a+"%"}}function f(){return function(a){return _.find(A,{value:a.data.key}).color}}function D(){return function(){return A.UPTIME.color}}function w(){return function(a){return l.getString(_.find(A,{value:a}).label)}}function x(){return function(a,t,i){var e=Math.round(i);return l.getPlural(e,"1 device","{{$count}} devices",{})}}function T(a){var t=_.find(a,{key:A.UPTIME.value}).val,i=_.find(a,{key:A.DOWNTIME.value}).val;return t/(t+i)*100}function E(a){return T(a)>50?"text-success":"text-danger"}var k=t.deviceId,G={},R=n("Availability percentage is based on the number of critical alarms raised and cleared."),I=n("Operability chart displays how many devices had their average availability on particular level in the last month."),P=i.createEnum([{name:"DAY",value:"day",label:n("Last day availability")},{name:"WEEK",value:"week",label:n("Last week availability")},{name:"MONTH",value:"month",label:n("Last month availability")}]),A=i.createEnum([{name:"DOWNTIME",value:"downtime",label:n("Downtime"),color:"#d9534f"},{name:"UPTIME",value:"uptime",label:n("Uptime"),color:"#5cb85c"}]);_.assign(a,{intervalsData:G,availabilityTooltip:R,operabilityTooltip:I,x:m,y:h,xGraph:y,yGraph:b,xTickFormat:g,color:f,colorGraph:D,tooltip:w,tooltipGraph:x,percentage:T,percentageClass:E}),r(),k||d()}a.$inject=["$scope","$routeParams","c8yBase","c8yAlarms","gettext","gettextCatalog"],angular.module("c8y.parts.availability").controller("availabilityReportCtrl",a)}(),function(){"use strict";function a(a){var t;t='<div ng-if="graphData">\n  <div class="card availabilityGraph">\n    <div class="card-header">\n      <h4 class="card-title" translate>Last month operability</h4>\n    </div>\n    <hr>\n    <div class="card-block">\n      <nvd3-multi-bar-chart data="graphData" id="availabilityGraph" height="200" width="900" x="xGraph()" y="yGraph()" xaxistickformat="xTickFormat()" color="colorGraph()" showxaxis="true" showyaxis="false" tooltips="true" tooltipcontent="tooltipGraph()">\n        <svg></svg>\n      </nvd3-multi-bar-chart>\n      <div class="text-center">\n        <small>{{operabilityTooltip | translate}}</small>\n      </div>\n    </div>\n  </div>\n</div>\n',a.put("availability/views/availability-graph.html",t),a.put("devicemanagement_availability/views/availability-graph.html",t),a.put("/apps/devicemanagement/availability/views/availability-graph.html",t),t='<div class="card welcome">\n  <div class="card-header">\n    <h4 class="card-title" translate>Availability</h4>\n  </div>\n  <hr>\n  <div class="row">\n    <div class="col-sm-4" ng-repeat="intervalData in intervalsData | orderBy:\'order\'">\n      <div class="card-block">\n        <h5 class="text-center">\n          <span ng-bind="intervalData.label | translate"></span>\n        </h5>\n        <div class="availabilityPie" style="position:relative">\n          <span class="percentage" ng-class="percentageClass(intervalData.data)">\n            {{percentage(intervalData.data)|number:0}}%\n          </span>\n          <nvd3-pie-chart data="intervalData.data" id="interval{{$index}}" height="300" width="300" x="x()" y="y()" tooltips="true" tooltipcontent="tooltip()" color="color()" donut="true" donutratio=".45">\n          <svg></svg>\n          </nvd3-pie-chart>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="card-footer text-center">\n    <small>{{availabilityTooltip | translate}}</small>\n  </div>\n</div>\n',a.put("availability/views/availability-pie.html",t),a.put("devicemanagement_availability/views/availability-pie.html",t),a.put("/apps/devicemanagement/availability/views/availability-pie.html",t),t='<div class="card-group">\n  <div ng-repeat="intervalData in intervalsData | orderBy:\'order\'" class="availabilityPie col-md-4 col-xs-12">\n    <div class="card">\n      <div class="card-header">\n        <h4 class="card-title">\n          <span ng-bind="intervalData.label | translate"></span>\n        </h4>\n      </div>\n      <hr>\n      <div class="card-block">\n        <div style="position:relative">\n          <span class="percentage" ng-class="percentageClass(intervalData.data)">\n            {{percentage(intervalData.data)|number:0}}%\n          </span>\n          <nvd3-pie-chart data="intervalData.data" id="interval{{$index}}" height="500" width="600" x="x()" y="y()" tooltips="true" tooltipcontent="tooltip()" color="color()" donut="true" donutratio=".55">\n          <svg></svg>\n          </nvd3-pie-chart>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="center-block text-center">\n    <small>{{availabilityTooltip | translate}}</small>\n  </div>\n</div>\n\n<div ng-if="graphData">\n  <div class="card availabilityGraph">\n    <div class="card-header">\n      <h4 class="card-title" translate>Last month operability</h4>\n    </div>\n    <hr>\n    <div class="card-block">\n      <nvd3-multi-bar-chart data="graphData" id="availabilityGraph" height="300" width="1000" x="xGraph()" y="yGraph()" xaxistickformat="xTickFormat()" color="colorGraph()" showxaxis="true" showyaxis="false" tooltips="true" tooltipcontent="tooltipGraph()">\n        <svg></svg>\n      </nvd3-multi-bar-chart>\n      <small>{{operabilityTooltip | translate}}</small>\n    </div>\n  </div>\n</div>\n',a.put("availability/views/detail.html",t),a.put("devicemanagement_availability/views/detail.html",t),a.put("/apps/devicemanagement/availability/views/detail.html",t)}angular.module("c8y.parts.availability").run(["$templateCache",a])}();