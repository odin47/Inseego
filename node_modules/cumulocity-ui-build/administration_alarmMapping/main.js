/* administration_alarmMapping 9.12.5 2018-08-27T16:53:20+00:00 b689bea882f7+ (release/9.12.0) tip */
angular.module("c8y.parts.alarmMapping",[]).config(["c8yNavigatorProvider","c8yViewsProvider","gettext",function(n,t,e){"use strict";n.addNavigation({parent:{name:e("Business rules"),icon:"c8y-business-rules"},name:e("Alarm mapping"),path:"alarmmapping",icon:"bell",priority:2900}),t.when("/alarmmapping",{templateUrl:"administration_alarmMapping/views/index.html"})}]),function(){"use strict";function n(n,t,e,a,i,s,l,o,r){function c(e){n.options=e,O(t.when(e.length))}function p(n){var t=n.value.split("|");return n.severity=t.shift(),n.description=t.join("|"),delete n.value,n}function d(n){return{key:n.key,category:n.category,value:n.severity+"|"+(n.description||"")}}function m(n){return _.map(n,p)}function u(){var t={category:N};n.loading=!0,a.detail(t).then(v).then(m).then(c).finally(function(){n.loading=!1})}function v(n){return _.map(n.data,function(n,t){return{category:N,value:n,key:t}})}function g(n){return _.cloneDeep(n)}function y(n){return i.icon(n)||"circle"}function b(n){return"NONE"===n?"text-muted":n}function f(){k.newOption=n.newOption={category:N,severity:"WARNING"}}function h(n){return!n.self}function w(t){var e=(h(t)?"create":"update")+"Option",i=d(t);a[e](i).finally(function(){n.status.isOpen=!1,delete n.newOption,delete k.newOption}).then(u)}function x(n){var t=d(n);s({title:o("Confirm delete?"),body:r.getString('Do you really want to alarm mapping for alarm type "{{optionKey}}"?',{optionKey:n.key}),status:"danger",size:"sm",labels:{ok:o("Delete")}}).then(angular.bind(a,a.deleteOption,t)).then(u)}function O(n){var t=n.then(function(n){return{title:o("Alarm mapping"),subtitle:!_.isUndefined(n)&&n>0?r.getPlural(n,"1 mapping","{{qty}} mappings",{qty:n}):""}});l.changeTitle(t)}var k=this,N="alarm.type.mapping",A=o("Alarm mappings automatically transform the description and severity based on alarm type matching. Alarm types are a defined property of each alarm created on the platform."),D=e.createEnum([{name:"NONE",label:o("Drop"),icon:"circle",class:"text-muted"},{name:"CRITICAL",label:o("Critical"),icon:y("critical"),class:"status critical"},{name:"MAJOR",label:o("Major"),icon:y("major"),class:"status major"},{name:"MINOR",label:o("Minor"),icon:y("minor"),class:"status minor"},{name:"WARNING",label:o("Warning"),icon:y("warning"),class:"status warning"}]);k.severities=n.severities=D,n.icon=y,n.iconClass=b,n.getOptionCopy=g,n.refresh=u,n.add=f,n.save=w,n.onClickDelete=x,n.helpText=A,n.paging={refresh:!0},n.status={isOpen:!1},u(),n.$watch("status.isOpen",function(n,t){n&&f()})}n.$inject=["$scope","$q","c8yBase","c8ySettings","c8yAlarms","c8yModal","c8yTitle","gettext","gettextCatalog"],angular.module("c8y.parts.alarmMapping").controller("alarmMappingCtrl",n)}(),function(){"use strict";function n(n){var t;t='<div data-ng-controller="alarmMappingCtrl as vm">\n\n  <c8y-ui-action-bar-set>\n    <li>\n      <div class="dropdown" uib-dropdown auto-close="outsideClick" is-open="status.isOpen">\n        <button class="dropdown-toggle c8y-dropdown" uib-dropdown-toggle aria-haspopup="true" aria-expanded="false">\n          <span><i c8y-icon="plus-circle"></i> <translate>Add alarm mapping</translate></span>\n        </button>\n        <ul class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>\n          <li class="dropdown-form">\n            <form role="form" name="newOptionForm" class="panel-body" novalidate>\n              <div class="form-group">\n                <label class="text-truncate" translate title="{{\'Alarm type to match\' | translate}}">Alarm type to match</label>\n                <input type="text" class="form-control" ng-model="vm.newOption.key" placeholder="{{\'e.g.\' | translate}} c8y_MissingMeasurementsAlarm" required>\n              </div>\n              <div class="form-group">\n                <label translate class="text-truncate" title="{{\'New description\' | translate}}">New description</label>\n                <input type="text" class="form-control" ng-model="vm.newOption.description">\n              </div>\n              <div class="form-group">\n                <label translate class="test-truncate" title="{{\'New severity\' | translate}}">New severity</label>\n                <label ng-repeat="severity in vm.severities.values()" class="c8y-radio input-sm">\n                  <input type="radio" name="c8y-group" value="{{severity.value}}" ng-model="vm.newOption.severity" ng-class="{\'active\': vm.newOption.severity === severity.value}">\n                  <span></span>\n                  <i c8y-icon="{{severity.icon}}" ng-class="severity.class" style="font-size: 14px">\n                  </i>\n                  <span ng-bind="severity.label | translate"></span>\n                </label>\n              </div>\n              <button class="btn btn-primary" ng-click="save(vm.newOption)" ng-disabled="newOptionForm.$invalid" translate>Add alarm mapping</button>\n            </form>\n          </li>\n        </ul>\n      </div>\n    </li>\n\n    <c8y-refresh-btn></c8y-refresh-btn>\n  </c8y-ui-action-bar-set>\n\n  <div class="row">\n    <div class="col-md-3 col-md-push-9">\n      <div class="card">\n        <div class="card-header hidden-sm hidden-xs">\n          <h4 class="card-title" translate>Alarm mapping</h4>\n        </div>\n        <hr class="hidden-sm hidden-xs">\n        <div class="card-block">\n          <p style="white-space: pre-wrap">{{helpText | translate}}</p>\n        </div>\n      </div>\n    </div>\n\n    <div class="col-md-9 col-md-pull-3">\n      <div class="c8y-empty-state text-center" ng-show="options.length == 0">\n        <h1 c8y-icon="bell"></h1>\n        <h3 translate>There are no alarm mappings defined</h3>\n        <p translate>Add your first alarm mapping using the button on the toolbar.</p>\n        <p c8y-guide-docs><small translate>Find out more on the <a c8y-guide-href="users-guide/administration/#reprio-alarms">User Guide</a>.</small></p>\n      </div>\n      <div class="list-group">\n        <div ng-repeat="option in options | orderBy:\'key\'" class="list-group-item flex-row collapsible" ng-class="{\'expanded\': isDetailExpanded}">\n          <div class="list-item-actions">\n            <button type="button" title="{{\'Expand\' | translate}}" class="collapse-btn" ng-click="isDetailExpanded = !isDetailExpanded">\n            <i c8y-icon="chevron-down"></i>\n          </button>\n          </div>\n\n          <div class="list-item-icon">\n            <i c8y-icon="{{icon(option.severity)}}" class="status" ng-class="iconClass(option.severity)|lowercase" uib-tooltip="{{option.severity | translate}}"></i>\n          </div>\n\n          <div class="list-item-body" ng-click="isDetailExpanded = !isDetailExpanded">\n            <div class="row">\n              <div class="col-sm-10 col-xs-12">\n                <span ng-click="isDetailExpanded = !isDetailExpanded">{{option.key}}</span>\n                <small class="text-muted" ng-if="option.description" ng-bind="option.description"></small>\n                <small class="text-muted" ng-if="!option.description" ng-bind="\'<kept as is>\' | translate"></small>\n              </div>\n              <div class="col-sm-2 text-right showOnHover hidden-xs">\n                <button class="btn btn-danger btn-xs" ng-click="onClickDelete(option)" title="{{\'Delete\' | translate}}">\n                <i c8y-icon="trash"></i>\n              </button>\n              </div>\n            </div>\n          </div>\n\n          <div class="collapse" uib-collapse="!isDetailExpanded" data-ng-init="optionToEdit = getOptionCopy(option)">\n            <form role="form" name="optionForm" novalidate>\n              <div class="row">\n                <div class="form-group col-lg-3">\n                  <label class="text-truncate" translate title="{{\'Alarm type to match\' | translate}}">Alarm type to match</label>\n                  <input type="text" class="form-control" ng-model="optionToEdit.key" disabled="disabled">\n                </div>\n                <div class="form-group col-lg-3">\n                  <label class="text-truncate" translate title="{{\'New description\' | translate}}">New description</label>\n                  <input type="text" class="form-control" ng-model="optionToEdit.description">\n                </div>\n                <div class="form-group col-lg-6">\n                  <label class="text-truncate" translate title="{{\'New severity\' | translate}}">New severity</label>\n                  <div class="flex-row-sm wrap">\n                    <label ng-repeat="severity in severities.values()" class="c8y-radio input-sm" ng-class="{\'right-m-sm\': !$last}">\n                    <input type="radio" name="c8y-group" value="{{severity.value}}" ng-model="optionToEdit.severity" ng-class="{\'active\': optionToEdit.severity === severity.value}">\n                    <span></span>\n                    <i c8y-icon="{{severity.icon}}" ng-class="severity.class" style="font-size: 14px">\n                    </i>\n                    <span ng-bind="severity.label | translate"></span>\n                  </label>\n                  </div>\n                </div>\n              </div>\n              <button class="btn btn-danger visible-xs-inline-block" title="{{\'Delete\' | translate}}" ng-click="onClickDelete(option)">\n              <i c8y-icon="trash"></i> {{\'Delete\' | translate}}\n            </button>\n              <button class="btn btn-primary" ng-click="save(optionToEdit)" ng-disabled="optionForm.$invalid || optionForm.$pristine" style="margin-left:0" translate>Save\n            </button>\n              <br>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div></div>',n.put("alarmMapping/views/index.html",t),n.put("administration_alarmMapping/views/index.html",t),n.put("/apps/administration/alarmMapping/views/index.html",t)}angular.module("c8y.parts.alarmMapping").run(["$templateCache",n])}();