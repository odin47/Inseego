/* core_deviceStatusWidget 9.12.5 2018-08-27T16:54:03+00:00 b689bea882f7+ (release/9.12.0) tip */
!function(){"use strict";function e(e,t){e.add({name:"deviceStatusWidget",nameDisplay:t("Device status"),description:t("Widget displays connectivity status for particular device"),widgetComponent:"c8yDeviceStatus",options:{groupSelectable:!1}})}e.$inject=["c8yComponentsProvider","gettext"],angular.module("c8y.deviceStatus",[]).config(e)}(),function(){"use strict";function e(e,t,n,i,a,s){function l(){a.detailRealtime(r.config.device.id,e,c).then(function(e){r.device=e})}function c(e){r.status=s.status(e)}var r=this;_.assign(r,{$onInit:l})}e.$inject=["$scope","c8yUser","c8yPermissions","c8yAlert","c8yDevices","c8yDeviceStatus"],angular.module("c8y.deviceStatus").component("c8yDeviceStatus",{controller:e,controllerAs:"vm",templateUrl:"core_deviceStatusWidget/deviceStatus.html",bindings:{config:"<"}})}(),function(){"use strict";angular.module("c8y.deviceStatus").component("deviceAvailabilityStatus",{controllerAs:"vm",templateUrl:"core_deviceStatusWidget/availability.html",bindings:{device:"<",status:"<"}})}(),function(){"use strict";function e(e,t,n,i,a){function s(){o(g.device);var n=_.pick(g.device,["id","c8y_RequiredAvailability"]);return g.saveInProgress=!0,t.save(n).then(function(){g.saveInProgress=!1,p()}).then(function(){e.success(a("Required interval setting updated successfully."))})}function l(e){t.switchResponseInterval(e)}function c(){r()}function r(){var e=_.get(g.device,"c8y_RequiredAvailability");_.isEqual(e,w)||(d(e),w=e)}function o(t){if(t.c8y_RequiredAvailability=t.c8y_RequiredAvailability||{},!(t.c8y_RequiredAvailability&&t.c8y_RequiredAvailability.responseInterval<0)){var n=Math.round(g.responseInterval);if(t.c8y_RequiredAvailability.responseInterval=n,t.c8y_Tracking&&t.c8y_Tracking.interval&&t.c8y_Tracking.interval!==n*y){var i=void 0;i=a(t.c8y_Tracking.interval>n*y?"Changing this value can cause showing false offline statuses and prevent alarms from being created as early as possible":"Changing this value can cause showing false online statuses and prevent alarms from being created as early as possible"),e.add({text:i,type:"warning"})}v(t.c8y_RequiredAvailability)}}function d(e){v(e)}function v(e){var t=e&&0!==e.responseInterval;_.set(g,"responseInterval",t?Math.abs(Number(e.responseInterval)):void 0)}function u(e){return n.validationHints(e,h)}function p(){g.isEditMode?g.isEditMode=!1:(S=g.responseInterval,g.isEditMode=!0)}function m(){g.responseInterval=S,g.isEditMode=!1}var g=this,y=60,b=525600,h={c8yMax:{required_availability:a("Required interval must be a number and cannot be longer than a year!")},c8yMin:{required_availability:a("Required interval must be a positive number!")}},f="availabilityForm",w=void 0,S=void 0;_.assign(g,{isEditMode:!1,saveInProgress:!1,maxRequiredIntervalLimit:b,save:s,switchMaintenance:l,$doCheck:c,toggleEdit:p,resetEdit:m,validationHints:u,keyHandler:function(e){return i.handle(e,s,m)},invalid:angular.bind(n,n.invalid,g,f)})}e.$inject=["c8yAlert","c8yDevices","c8yBase","keyboardKeyHandler","gettext"],angular.module("c8y.deviceStatus").component("requiredAvailabilityIntervalSetting",{controller:e,controllerAs:"vm",templateUrl:"core_deviceStatusWidget/requiredAvailabilityIntervalSetting.html",bindings:{device:"<",status:"<"}})}(),function(){"use strict";function e(e,t,n,i,a,s,l,c,r){function o(e){e.device.currentValue&&d()}function d(){a.hasId(w.device)&&v().then(u).catch(function(e){w.errorTooltipMessage=_.get(e,"message"),k.test(_.get(w,"device.owner"))||s.danger(r.getString('Device owner not found for device "{{name}}".',w.device))})}function v(){return i.canAdminMOs([w.device]).then(function(t){return w.canAdminDevice=t,t?e.resolve():e.reject(x)})}function u(){return t.getOwnerObject(_.get(w,"device.id"),{silentError:!0}).then(function(e){w.owner=e})}function p(){var n=_.get(w,"device.id");return n&&w.canAdminDevice?t.setOwnerEnabled(n,w.owner.enabled).then(function(e){w.owner=e}):e.reject(x)}function m(){return w.errorTooltipMessage?"":S}function g(){w.isEditMode?w.isEditMode=!1:(w.isEditMode=!0,E=_.get(w,"device.owner"))}function y(){n.detail(_.get(w,"device.owner"),{silentError:!0}).then(function(){return t.save(_.pick(w.device,["id","owner"]))}).then(function(){s.success(c("Device owner updated."))}).catch(function(){var e=w.device.owner;f(E),s.danger(r.getString("Couldn't find user {{errorUser}}. Device owner reverted back to be {{owner}}!",{errorUser:e,owner:w.device.owner}))})}function b(){g(),y()}function h(){g(),f(E)}function f(e){_.set(w,"device.owner",e)}var w=this,S=c("Activate/deactivate user"),x={message:c("You don't have permission to admin device")},k=/(service_)(.)+/,E=void 0;_.assign(w,{$onChanges:o,toggleOwner:p,toggleEdit:g,getTooltip:m,keyPressHandler:function(e){return l.handle(e,b,h)},save:b,cancel:h})}e.$inject=["$q","c8yInventory","c8yUser","c8yPermissions","c8yBase","c8yAlert","keyboardKeyHandler","gettext","gettextCatalog"],angular.module("c8y.deviceStatus").component("ownerStatus",{controller:e,controllerAs:"vm",templateUrl:"core_deviceStatusWidget/ownerStatus.html",bindings:{device:"<"}})}(),function(){"use strict";function e(e){function t(e,t,i){e.key===n.Enter.value?t():e.key===n.Escape.value&&i()}var n=e.createEnum(["Enter","Escape"]);return{handle:t}}e.$inject=["c8yBase"],angular.module("c8y.deviceStatus").factory("keyboardKeyHandler",e)}(),function(){"use strict";function e(e){var t;t='<div class="text-center" style="min-height:174px">\n  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="91px" height="91px" viewBox="0 0 91 91" enable-background="new 0 0 91 91" xml:space="preserve" class="center-block" style="max-width: 91px">\n  <g>\n  \t<path ng-class="vm.status.sendStatus.class" uib-tooltip-html="vm.status.sendStatus.tooltip | translate" tooltip-append-to-body="true" class="sendStatus" fill-rule="evenodd" clip-rule="evenodd" fill="url(#smallGradient)" d="M81.915,69.302L2.298,51.84c-0.34-2.196-0.516-4.446-0.516-6.738\n          c0-24.144,19.574-43.718,43.718-43.718c24.146,0,43.719,19.574,43.719,43.718C89.219,54.052,86.529,62.373,81.915,69.302z"/>\n  \t<path uib-tooltip-html="vm.status.sendStatus.tooltip | translate" tooltip-append-to-body="true" fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M70.987,29.212c0-0.246-0.108-0.465-0.272-0.628l-10.5-9.57\n          c-0.272-0.22-0.628-0.273-0.957-0.137c-0.328,0.137-0.52,0.438-0.52,0.792v6.125H24.613c-0.492,0-0.875,0.383-0.875,0.875v5.25\n          c0,0.492,0.383,0.875,0.875,0.875h34.125v6.124c0,0.356,0.22,0.657,0.52,0.794c0.329,0.136,0.685,0.081,0.957-0.165l10.5-9.679\n          C70.879,29.705,70.987,29.459,70.987,29.212z"/>\n  \t<path uib-tooltip-html="vm.status.pushStatus.tooltip | translate" tooltip-append-to-body="true" fill-rule="evenodd" clip-rule="evenodd" ng-class="vm.status.pushStatus.class" fill="url(#smallGradient)" class="pushStatus" d="M2.589,37.639c0.04-0.002,0.079-0.003,0.117-0.007\n          c16.654-0.996,32.494,2.44,47.519,10.309c12.112,6.343,24.539,9.779,37.28,10.309c-5.227,18.292-22.069,31.68-42.039,31.68\n          c-24.145,0-43.717-19.573-43.717-43.717C1.749,43.279,2.037,40.412,2.589,37.639z"/>\n  \t<path uib-tooltip-html="vm.status.pushStatus.tooltip | translate" tooltip-append-to-body="true" fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M66.196,60.339c0-0.492-0.382-0.875-0.875-0.875H31.196V53.34\n          c0-0.355-0.219-0.656-0.52-0.792c-0.328-0.138-0.684-0.083-0.957,0.163l-10.5,9.68c-0.164,0.164-0.273,0.411-0.273,0.656\n          c0,0.247,0.109,0.465,0.273,0.63l10.5,9.57c0.273,0.218,0.629,0.272,0.957,0.136c0.329-0.136,0.52-0.437,0.52-0.793v-6.125h34.125\n          c0.493,0,0.875-0.383,0.875-0.875V60.339z"/>\n  \t<g>\n  \t\t<defs>\n  \t\t\t<circle id="SVGID_1_" cx="45.5" cy="45.5" r="45.5"/>\n        <radialGradient id="smallGradient" fy="50%">\n           <stop offset="0%" stop-color="#cacace">\n             <animate attributeName="stop-color" values="#cacace;#ffffff;#cacace" dur="1s" repeatCount="indefinite"></animate>\n           </stop>\n           <stop offset="100%" stop-color="#cacace"></stop>\n         </radialGradient>\n  \t\t</defs>\n  \t\t<clipPath id="SVGID_2_">\n  \t\t\t<use xlink:href="#SVGID_1_" overflow="visible"/>\n  \t\t</clipPath>\n\n  \t\t\t<circle clip-path="url(#SVGID_2_)" fill="none" ng-class="{\'fill-warning\': !!vm.status.maintenanceStatus}" stroke="#E5E7E7" stroke-width="6.3927" stroke-miterlimit="10" cx="45.5" cy="45.5" r="45.5"/>\n  \t</g>\n  </g>\n  <path ng-if="!!vm.status.maintenanceStatus" fill-rule="evenodd" clip-rule="evenodd" fill="#ffffff" d="M69.7,35.694c0,0.973-0.354,2.182-0.679,3.126\n        c-1.858,5.249-6.902,8.878-12.477,8.878c-7.285,0-13.214-5.929-13.214-13.214s5.929-13.214,13.214-13.214\n        c2.154,0,4.955,0.648,6.755,1.858c0.294,0.207,0.471,0.473,0.471,0.826c0,0.325-0.207,0.647-0.471,0.826l-8.643,4.983v6.606\n        l5.693,3.156c0.973-0.561,7.816-4.865,8.405-4.865C69.346,34.662,69.7,35.104,69.7,35.694z M51,48.523L30.886,68.638\n        c-0.679,0.679-1.652,1.092-2.656,1.092c-1.002,0-1.976-0.413-2.684-1.092l-3.125-3.186c-0.708-0.678-1.122-1.651-1.122-2.654\n        c0-1.002,0.413-1.975,1.122-2.685L42.506,40.03C44.04,43.894,47.137,46.99,51,48.523z M32.006,60.911\n        c0-1.032-0.855-1.887-1.888-1.887c-1.033,0-1.888,0.854-1.888,1.887s0.855,1.887,1.888,1.887\n        C31.15,62.798,32.006,61.943,32.006,60.911z"/>\n  </svg>\n\n  <h4 uib-tooltip-html="vm.status.sendStatus.tooltip | translate">\n    <span ng-if="!!vm.status.sendStatus" ng-class="vm.status.sendStatus.class" class="description">\n      {{vm.status.sendStatus.label | translate}}\n    </span>\n  </h4>\n\n  <p class="text-center" uib-tooltip-html="vm.status.pushStatus.tooltip | translate">\n    <span ng-if="!!vm.status.pushStatus" class="description" ng-class="vm.status.pushStatus.class">\n      {{vm.status.pushStatus.label | translate}}\n    </span>\n  </p>\n\n  <h4 ng-if="!!vm.status.maintenanceStatus">\n    {{vm.parseAvailability(\'MAINTENANCE\') | translate}}\n  </h4>\n  <label class="small" style="margin-bottom:0">{{\'Last communication\' | translate}}</label>\n  <p style="margin-top: -4px">{{vm.device.c8y_Availability.lastMessage|absoluteDate}}</p>\n</div>',e.put("deviceStatusWidget/availability.html",t),e.put("core_deviceStatusWidget/availability.html",t),e.put("/apps/core/deviceStatusWidget/availability.html",t),t='<div class="card-block bg-white" style="padding-top:0">\n  <device-availability-status device="vm.device" status="vm.status"></device-availability-status>\n</div>\n<div class="card-block bg-gray-white" style="padding-bottom:0">\n  <required-availability-interval-setting device="vm.device" status="vm.status"></required-availability-interval-setting>\n  <owner-status device="vm.device"></owner-status>\n</div>',e.put("deviceStatusWidget/deviceStatus.html",t),e.put("core_deviceStatusWidget/deviceStatus.html",t),e.put("/apps/core/deviceStatusWidget/deviceStatus.html",t),t='<div class="tight-grid">\n  <div class="flex-row" style="min-height: 40px">\n    <label class="col-xs-5 small" style="margin:0" translate>Owner\n    </label>\n    <div class="col-xs-7 small">\n      <div class="flex-row">\n        <div class="col-xs-5" ng-show="!vm.isEditMode">\n          <label class="c8y-switch" uib-tooltip="{{vm.errorTooltipMessage | translate}}" title="{{vm.getTooltip() | translate}}" tooltip-append-to-body="true">\n            <input type="checkbox" ng-click="vm.toggleOwner()" ng-model="vm.owner.enabled" ng-disabled="!(vm.canAdminDevice && vm.owner)">\n            <span></span>\n          </label>\n        </div>\n        <span class="text-truncate col-xs-6" title="{{vm.device.owner}}" ng-show="!vm.isEditMode">\n          {{vm.device.owner}}\n        </span>\n        <button class="btn-clean text-primary pull-right" ng-show="!vm.isEditMode && vm.canAdminDevice" ng-click="vm.toggleEdit()" title="{{\'Edit\' | translate}}">\n          <i c8y-icon="pencil"></i>\n        </button>\n        <div class="col-xs-12 ng-hide" ng-show="vm.isEditMode">\n          <div class="input-group input-group-editable">\n            <input class="form-control" ng-model="vm.device.owner" placeholder="{{\'e.g.\' | translate}} device_{{\'exampleUser\' | translate}}" ng-keyup="vm.keyPressHandler($event)">\n            <div class="input-group-btn" ng-show="vm.isEditMode">\n              <button class="btn btn-clean" ng-click="vm.save()">\n                <span><i c8y-icon="check" class="text-success"></i></span>\n              </button>\n            </div>\n            <div class="input-group-btn" ng-show="vm.isEditMode">\n              <button class="btn btn-clean" ng-click="vm.cancel()">\n                <i c8y-icon="times" class="text-danger"></i>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n',e.put("deviceStatusWidget/ownerStatus.html",t),e.put("core_deviceStatusWidget/ownerStatus.html",t),e.put("/apps/core/deviceStatusWidget/ownerStatus.html",t),t='<div ng-form="vm.availabilityForm" class="tight-grid">\n  <div class="flex-row" style="min-height: 40px">\n    <label class="col-xs-5 small" style="margin:0" translate>Required interval</label>\n    <p class="col-xs-7" ng-hide="vm.isEditMode">\n      <span>{{vm.responseInterval || \'---\'}}</span>\n      <span translate translate-n="vm.responseInterval" translate-plural="minutes">minute</span>\n      <button class="btn-clean text-primary pull-right" ng-hide="!!vm.status.maintenanceStatus" ng-click="vm.toggleEdit()" title="{{\'Edit\' | translate}}">\n        <i c8y-icon="pencil"></i>\n      </button>\n    </p>\n    <div class="col-xs-7 ng-hide" ng-show="vm.isEditMode">\n      <div class="input-group input-group-editable" ng-class="{\'has-error\': vm.invalid(\'required_availability\')}">\n        <input id="required_availability" name="required_availability" class="form-control" placeholder="{{\'e.g. 1\' | translate}}" ng-disabled="vm.device.c8y_RequiredAvailability.responseInterval < 0 || !vm.isEditMode" ng-model="vm.responseInterval" ng-keyup="vm.keyHandler($event)" c8y-number c8y-max="vm.maxRequiredIntervalLimit" c8y-min="0" uib-tooltip="{{vm.validationHints(vm.availabilityForm.required_availability)}}" tooltip-append-to-body="true">\n        <div class="input-group-btn" ng-show="vm.isEditMode">\n          <button class="btn btn-clean" ng-disabled="vm.saveInProgress || vm.availabilityForm.$invalid || !!vm.status.maintenanceStatus" ng-click="vm.save()">\n            <span ng-hide="vm.saveInProgress"><i c8y-icon="check" class="text-success"></i></span>\n            <span ng-show="vm.saveInProgress"><i c8y-icon="circle-o-notch" class="fa-spin"></i></span>\n          </button>\n        </div>\n        <div class="input-group-btn" ng-show="vm.isEditMode">\n          <button class="btn btn-clean" ng-disabled="vm.saveInProgress || !!vm.status.maintenanceStatus" ng-click="vm.resetEdit()">\n            <i c8y-icon="times" class="text-danger"></i>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n<div ng-if="vm.device.c8y_Availability && vm.device.c8y_RequiredAvailability" class="tight-grid">\n  <div class="flex-row">\n    <label class="col-xs-5 small" style="margin:0" translate>Maintenance</label>\n    <div class="col-xs-7">\n      <label class="c8y-switch">\n        <input type="checkbox" ng-click="vm.switchMaintenance(vm.device)" ng-checked="vm.status.maintenanceStatus">\n        <span></span>\n      </label>\n    </div>\n  </div>\n</div>\n',e.put("deviceStatusWidget/requiredAvailabilityIntervalSetting.html",t),e.put("core_deviceStatusWidget/requiredAvailabilityIntervalSetting.html",t),e.put("/apps/core/deviceStatusWidget/requiredAvailabilityIntervalSetting.html",t)}angular.module("c8y.deviceStatus").run(["$templateCache",e])}();