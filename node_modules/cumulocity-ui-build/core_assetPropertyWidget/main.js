/* core_assetPropertyWidget 9.12.5 2018-08-27T16:53:22+00:00 b689bea882f7+ (release/9.12.0) tip */
!function(){"use strict";function e(e,t){e.add({name:"Asset Properties",nameDisplay:t("Asset properties"),description:t("Editable form for asset properties."),templateUrl:"core_assetPropertyWidget/views/main.html",configTemplateUrl:"core_assetPropertyWidget/views/config.html",options:{groupsSelectable:!0}})}angular.module("c8y.parts.assetPropertyWidget",[]).config(["c8yComponentsProvider","gettext",e])}();var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_slicedToArray=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){"use strict";function e(e,t,n,r,i,o,a,c){function s(){$.cache.clear(),e.$emit("stopRealtime"),l().then(u).then(d).then(b)}function l(){var t=e.child.config.device.id;return n.detailRealtime(t,e).then(function(t){e.managedObject=t})}function u(){return $().then(function(t){i.attach(e.managedObject,t)})}function d(){return $().then(function(e){return r.getSchema(e)}).then(function(t){e.schema=t})}function p(){return t.all({configProperties:f(),discoveredProperties:m()}).then(function(e){var t=e.configProperties,n=e.discoveredProperties;return _(t).concat(n).uniqBy("id").value()})}function f(){var e=T("properties",[]);return _.filter(e,"__active")}function m(){return T("allowDisplayAndEditKnownProperties",!1)?g().then(function(e){return _.filter(e,y)}):[]}function g(){return r.list().then(function(e){return _.filter(e,h)})}function h(e){return 1===e.keyPath.length}function y(t){return _.has(e.managedObject,t.keyPath[0])}function b(){P(!0)}function v(){e.managedObject=_.cloneDeep(e.managedObject),u(),P(!1)}function P(n){return t.all({properties:$(),options:w(n)}).then(function(e){var t=e.properties,n=e.options;return r.getForm(t,n)}).then(function(t){e.form=t,e.editable=!n})}function w(e){var t={};return e&&(t.readonly=e,t.feedback=!1,t.disableSuccessState=!0,t.disableErrorState=!0),t}function j(){v()}function O(){return T("allowDisplayAndEditKnownProperties",!1)}function S(){var t={includeTree:!1,includeTreeChildren:!1,showComputed:!1,showRootPropertiesOnly:!0,managedObject:e.managedObject,hideExistingInMO:!0};return c.openSelector(t).then(W)}function W(e){k(e),$.cache.clear(),d().then(function(){return P(!1)})}function k(t){_.forEach(t,function(t){var n=_slicedToArray(t.keyPath,1),r=n[0];_.isUndefined(e.managedObject[r])&&(e.managedObject[r]=null)})}function A(){return E().then(n.save).then(function(){return o.success(a("Changes saved."))}).then(s)}function E(){return C().then(function(t){return _extends({id:e.managedObject.id},_.pick(e.managedObject,_.map(t,"keyPath[0]")))})}function C(){return $().then(function(e){return _.reject(e,{computed:!0})})}function x(){s()}function T(t,n){return _.get(e.child.config.options,t,n)}var $=_.memoize(p);e.$watch("child.config.options",s),_.assign(e,{startEdit:j,canAddProperties:O,addProperties:S,save:A,cancelEdit:x})}e.$inject=["$scope","$q","c8yInventory","c8yPropertiesLibrary","c8yComputedProperties","c8yAlert","gettext","SchemaPropertiesSvc"],angular.module("c8y.parts.assetPropertyWidget").controller("assetPropertyWidgetCtrl",e)}(),function(){"use strict";function e(e){var t;t='<c8y-property-selector properties="config.options.properties" managed-object="config.device" hide-actions="true" hide-computed="true" show-render-type="false" include-tree-children="true" default-properties="[\'c8ySchema!!id\', \'c8ySchema!!name\', \'c8ySchema!!type\']" allow-duplicates="false" single-property-selection="false">\n</c8y-property-selector>\n',e.put("assetPropertyWidget/views/config.html",t),e.put("core_assetPropertyWidget/views/config.html",t),e.put("/apps/core/assetPropertyWidget/views/config.html",t),t='<div ng-controller="assetPropertyWidgetCtrl">\n  <c8y-schema-form schema="schema" form="form" model="managedObject" class="widget" ng-class="{\'form-read-only\': !editable}">\n  </c8y-schema-form>\n  <c8y-if-allowed admin-mos="[managedObject]">\n    <div class="top-m-lg right-m-md left-m-md bottom-m-lg">\n        <button ng-show="editable && canAddProperties()" class="btn-add-block" ng-click="addProperties()">\n        <i c8y-icon="plus-circle"></i>\n        <translate>Add fragment</translate>\n      </button>\n    </div>\n\n    <div c8y-widget-footer>\n        <button class="btn btn-link" style="min-width:0; padding-left:0" ng-click="startEdit()" ng-show="!editable">\n          <i c8y-icon="pencil"></i>\n          <translate>Edit</translate>\n        </button>\n        <button class="btn btn-default btn-sm" ng-click="cancelEdit()" ng-show="editable" translate>\n          Cancel\n        </button>\n        <button class="btn btn-primary btn-sm" ng-click="save()" ng-show="editable" translate>\n          Save\n        </button>\n    </div>\n  </c8y-if-allowed>\n</div>\n',e.put("assetPropertyWidget/views/main.html",t),e.put("core_assetPropertyWidget/views/main.html",t),e.put("/apps/core/assetPropertyWidget/views/main.html",t)}angular.module("c8y.parts.assetPropertyWidget").run(["$templateCache",e])}();