/* core_binaryArtefactsManagement 9.12.5 2018-08-27T16:53:24+00:00 b689bea882f7+ (release/9.12.0) tip */
angular.module("c8y.binaryArtefactsManagement",[]).config(["c8yNavigatorProvider","c8yViewsProvider","gettext",function(n,e,t){"use strict";var i=t("Management"),a=t("Files repository"),l="c8y-archive",s="files",o=1e3,r="core_binaryArtefactsManagement/views/list.html";n.addNavigation({parent:i,name:a,priority:o,path:s,icon:l}),e.when("/"+s,{name:a,templateUrl:r})}]),angular.module("c8y.binaryArtefactsManagement").controller("binaryArtefactsListCtrl",["$scope","$q","$upload","$window","c8yInventory","c8yModal","c8yBase","c8yTitle","c8yBinary","gettext","gettextCatalog",function(n,e,t,i,a,l,s,o,r,c,d){"use strict";function p(){u().then(g).then(f)}function u(n){return r.list(n)}function g(e){n.files&&!n.refreshLoading||(n.files=[]),n.paging=e.paging,e.forEach(function(e){e.icon=r.icon(e),n.files.push(e)})}function f(){o.changeTitle({title:c("Files repository")})}function m(){n.paging.loading=!0,n.paging.next().then(g).finally(function(){n.paging.loading=!1})}function v(){n.refreshLoading=!0,n.paging.refresh().then(g).finally(function(){n.refreshLoading=!1})}function y(n){return M.indexOf(n)}function h(n){return y(n)>-1}function b(n){h(n)?M.splice(y(n),1):(M.push(n),w(n))}function w(n){r.isImage(n)&&!n.dataUri&&r.downloadAsDataUri(n).then(function(e){n.dataUri=e})}function x(e){l({title:c("Confirm delete?"),body:d.getString('Do you really want to remove file "{{name}}"?',{name:e.name}),status:"danger"}).then(angular.bind(r,r.removeBinary,e)).then(angular.bind(s,s.removeFromList,n.files,e))}function A(n){l({templateUrl:"core_binaryArtefactsManagement/views/upload.html",controller:"binaryArtefactsUploadCtrl",title:c("Upload files"),backdrop:"static"}).then(v)}var M=[];n.loadNext=m,n.refresh=v,n.toggle=b,n.isOpen=h,n.onClickDelete=x,n.upload=A,n.size=r.size,n.isImage=r.isImage,n.popoverTemplateUrl="core_binaryArtefactsManagement/views/popover.html",p()}]),function(){"use strict";function n(n,e,t,i,a,l){function s(){return!n.uploading&&_.every(n.files,function(n){return a.hasValidSize(n.file)})}function o(){var o=t.defer();return s()?(n.uploading=!0,_.forEach(n.files,function(n){var e=a.upload(n.file);c.push(e),e.progress(function(n){e.uploadProgress=n.loaded/n.total,o.notify(_(c).map("uploadProgress").reduce(function(n,e){return n+e})/c.length)})}),t.all(c).then(function(n){return o.resolve(n)})):o.reject(),n.uploadProgress=0,o.promise.then(function(){i.success(l("Files successfully uploaded!")),e.close()},function(){i.danger(l("Could not upload the files!"))},function(e){n.uploadProgress=100*e}).finally(function(){n.uploading=!1,n.uploadProgress=100})}function r(){_.forEach(c,function(n){return n.abort()})}var c=[];n.uploading=!1,n.uploadProgress=0,n.allowMultipleFiles=!0,n.filesRequired=!0,n.files=[],_.assign(n,{canUpload:s,upload:o,dismiss:e.dismiss}),e.closed.then(r)}n.$inject=["$scope","$uibModalInstance","$q","c8yAlert","c8yBinary","gettext"],angular.module("c8y.binaryArtefactsManagement").controller("binaryArtefactsUploadCtrl",n)}(),function(){"use strict";function n(n){var e;e='<div ng-controller="binaryArtefactsListCtrl as vm">\n\n  <c8y-ui-action-bar-set>\n    <li class="navbar-form" action-bar-position="left" ng-show="files.length > 0">\n      <div class="input-group input-group-search">\n        <input type="search" class="form-control" placeholder="{{\'Filter\' | translate}}&hellip;" ng-model="vm.searchString"/>\n        <span class="input-group-addon">\n            <i c8y-icon="search" ng-show="vm.searchString.length === 0 || !vm.searchString "></i>\n            <i c8y-icon="times" class="text-muted" ng-show="vm.searchString.length > 0" ng-click="vm.searchString = \'\'"></i>\n        </span>\n      </div>\n    </li>\n\n    <li c8y-if-allowed any-role="[\'ROLE_INVENTORY_ADMIN\', \'ROLE_INVENTORY_CREATE\']">\n      <button class="btn btn-link" ng-click="upload()">\n        <i c8y-icon="upload"></i> <translate>Upload file</translate>\n      </button>\n    </li>\n\n    <c8y-refresh-btn></c8y-refresh-btn>\n  </c8y-ui-action-bar-set>\n\n\n  <div class="c8y-empty-state text-center" ng-show="files.length == 0">\n    <h1 c8y-icon="c8y-archive" class="c8y-icon-duocolor"></h1>\n    <h3 translate>No files to display.</h3>\n  </div>\n\n\n  <div class="list-group">\n\n    <div class="card" ng-show="filtered.length === 0 && files.length > 0">\n      <div class="c8y-empty-state text-left">\n        <h1 class="c8y-icon c8y-icon-archive c8y-icon-duocolor"></h1>\n        <p translate>No files found containing <strong>{{vm.searchString}}</strong>.</p>\n      </div>\n    </div>\n\n    <div class="list-group-item flex-row" ng-repeat="file in files | orderBy:\'name\' | filter:vm.searchString as filtered ">\n\n      <div class="list-item-actions">\n        <div class="settings pull-right dropdown" uib-dropdown is-open="menuOpen">\n          <button type="button" title="{{\'Options\' | translate}}" class="dropdown-toggle c8y-dropdown" uib-dropdown-toggle>\n            <i c8y-icon="ellipsis-v"></i>\n          </button>\n          <ul class="dropdown-menu" uib-dropdown-menu>\n            <li>\n              <c8y-download-button binary="file" downloading="file.downloading">\n              </c8y-download-button>\n            </li>\n            <li ng-show="!file.downloading">\n              <a href ng-disabled="file.c8y_applications_storage" title="{{\'Delete\' | translate}}" ng-click="onClickDelete(file)">\n                <i c8y-icon="trash"></i> {{\'Delete\' | translate}}\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n      <div class="list-item-icon">\n        <i c8y-icon="{{file.icon}}"></i>\n      </div>\n\n      <div class="list-item-body">\n        <div class="row">\n          <div class="col-sm-4 col-xs-12">\n            <div class="text-truncate" title="{{file.name}}, {{\'Owner\' | translate}}: {{file.owner}}">\n              {{file.name}}\n              <br>\n              <label class="small" translate>Owner</label> <small>{{file.owner}}</small>\n            </div>\n          </div>\n\n          <div class="col-sm-1 col-xs-12">\n            <span ng-show="isImage(file)">\n              <a href ng-click="toggle(file)" uib-popover-template="popoverTemplateUrl" popover-placement="auto" popover-append-to-body="true" popover-trigger="\'focus\'" title="{{\'Preview file\' | translate}}" class="btn btn-default btn-xs visible-xs-block visible-sm-inline-block visible-md-inline-block visible-lg-inline-block">\n              <i c8y-icon="search"></i>\n              </a>\n            </span>\n          </div>\n\n          <div class="col-sm-4 col-xs-12">\n            <div class="text-truncate">\n              <label class="small" translate>Type</label> <small>{{file.type}}</small>\n              <br>\n              <label class="small" translate>Size</label> <small>{{size(file)|bytes}}</small>\n            </div>\n          </div>\n\n          <div class="col-sm-3 col-xs-12">\n            <small class="text-muted" title="{{\'Last update\' | translate}}">\n              <i c8y-icon="calendar"></i> {{file.lastUpdated | absoluteDate}}\n            </small>\n          </div>\n        </div>\n      </div>\n\n    </div>\n  </div>\n\n  <c8y-load-more></c8y-load-more>\n</div>\n',n.put("binaryArtefactsManagement/views/list.html",e),n.put("core_binaryArtefactsManagement/views/list.html",e),n.put("/apps/core/binaryArtefactsManagement/views/list.html",e),e='<div style="position:relative; min-width:60px; min-height: 50px">\n  <span style="position:absolute; z-index:0">\n    <c8y-rectangle-spinner></c8y-rectangle-spinner>\n  </span>\n  <div style="position:relative; z-index:1; background-color: white">\n    <img ng-src="{{file.dataUri}}" class="img-responsive"/>\n  </div>\n</div>\n',n.put("binaryArtefactsManagement/views/popover.html",e),n.put("core_binaryArtefactsManagement/views/popover.html",e),n.put("/apps/core/binaryArtefactsManagement/views/popover.html",e),e='<div class="modal-header" ng-show="title">\n  <h3>{{title | translate}}</h3>\n</div>\n<div class="modal-inner-scroll">\n  <div class="modal-body">\n    <form role="form" name="filesUploadForm" novalidate>\n      <div class="form-group">\n        <label translate>Files to upload</label>\n        <file-picker files="files" multiple="true" required="filesRequired" disabled="uploading"></file-picker>\n      </div>\n    </form>\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btn btn-default" ng-click="dismiss()" translate>Cancel</button>\n  <button class="btn btn-primary" ng-click="upload()" ng-disabled="filesUploadForm.$invalid || !canUpload()">\n    <span ng-show="uploading"><i c8y-icon="circle-o-notch" class="fa-spin"></i> <translate>Uploading&hellip;</translate>({{uploadProgress|number:0}}%)</span>\n    <span ng-show="!uploading" translate>Upload</span>\n  </button>\n</div>\n',n.put("binaryArtefactsManagement/views/upload.html",e),n.put("core_binaryArtefactsManagement/views/upload.html",e),n.put("/apps/core/binaryArtefactsManagement/views/upload.html",e)}angular.module("c8y.binaryArtefactsManagement").run(["$templateCache",n])}();