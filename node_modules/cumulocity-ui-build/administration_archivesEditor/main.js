/* administration_archivesEditor 9.12.5 2018-08-27T16:53:21+00:00 b689bea882f7+ (release/9.12.0) tip */
!function(){"use strict";function e(e,t){e.when("/applications/:applicationId",{templateUrl:"administration_archivesEditor/views/index.html",controller:"ArchivesListCtrl as vm",icon:"archive",name:t("Archives"),showIf:["$routeParams","c8yApplication",i],priority:-4e3})}function i(e,i){return!(!e.applicationId||"new"===e.applicationId)&&i.detail(e.applicationId).then(function(e){var t=i.convertType(e.data);return i.isHosted(t)||i.isApamaCepRule(t)||i.isMicroserviceWithManifest(t)})}angular.module("c8y.parts.appArchives",[]).config(["c8yViewsProvider","gettext",e])}(),function(){"use strict";function e(e,i,t,n,a,r,s,o,l){function c(){e.paging={refresh:!0},t.detail(b).then(function(e){w=e.data,g.refresh()})}function d(){return e.refreshLoading=!0,t.listArchives(w).then(function(e){g.archives=e.attachments}).catch(function(){g.archives=[]}).finally(function(){e.refreshLoading=!1})}function u(e){return w.activeVersionId===e.id}function p(e){return g.toActivateVersionId===e.id}function v(e){var i=e.id||e,n=_.cloneDeep(w);return n.activeVersionId=i,g.toActivateVersionId=i,g.requestInProgress=!0,t.save(n).then(function(e){return f(e)}).then(function(e){w=e}).finally(function(){g.requestInProgress=!1})}function h(e){return r({title:o("Are you sure?"),body:l.getString("Do you really want to remove archive \"{{name}}{{description ? (' (' + description + ')') : ''}}\"?",e),status:"danger"}).then(function(){return g.requestInProgress=!0,t.deleteArchive(w,e).then(g.refresh).finally(function(){g.requestInProgress=!1})})}function f(e){var t=i.defer();return"APAMA_CEP_RULE"===w.type?(n.addListener(A,y,n.realtimeActions().UPDATE,function(i,a){a.id!==w.id||_.isUndefined(a.state)||(a.state.monitors.length>0?(t.resolve(e.data),n.destroySubscription(A,y)):a.state.errors.length>0&&(v(w.activeVersionId),s.danger(o("Failed to activate application"),a.state.errors[0]),t.reject(a.state.errors[0]),n.destroySubscription(A,y)))}),n.start(A,y)):t.resolve(e.data),t.promise}function m(){var e=i.when();return 6===g.archives.length&&(e=r({title:o("Are you sure?"),body:o("Up to 6 archives can be saved in the platform. If you upload a new archive, the oldest archive that is not active will be deleted. Do you want to proceed?")})),e.then(function(){g.requestInProgress=!0,g.uploadStatus.inProgress=!0,g.uploadStatus.progress=0;var n=_(g.appArchives).map("file").map(_.partial(t.uploadArchive,w)).value();return _.forEach(n,function(e){e.progress(function(i){e.uploadProgress=i.loaded/i.total;var t=_(n).map("uploadProgress").sum();g.uploadStatus.progress=100*t/n.length})}),i.all(n).catch(function(i){s.danger(o("Application archive could not be updated"),i),e.reject()}).finally(function(){g.requestInProgress=!1,g.uploadStatus.inProgress=!1,g.uploadStatus.progress=0})}).then(function(e){1===e.length&&(g.refresh(),g.setActive(e[0].data).then(g.refresh).then(function(){var e=o("APAMA_CEP_RULE"===w.type?"Application archive has been uploaded.":"Application archive has been uploaded and activated!");s.success(e)}))})}var g=this;_.assign(g,{refresh:d,isActive:u,toActivate:p,deleteArchive:h,uploadArchive:m,setActive:v,requestInProgress:!1,archives:[],uploadStatus:{inProgress:!1,progress:0}});var b=a.applicationId,y="/applications/*",A=e.$id,w=void 0;e.refresh=g.refresh,c()}e.$inject=["$scope","$q","c8yApplication","c8yRealtime","$routeParams","c8yModal","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.parts.appArchives").controller("ArchivesListCtrl",e)}(),function(){"use strict";function e(e,i,t,n,a){function r(){if(e.uploading)return i.reject();e.uploading=!0;var r=_(e.files).map("file").map(_.partial(n.uploadArchive,a)).value();return _.forEach(r,function(i){i.progress(function(t){i.uploadProgress=t.loaded/t.total,e.uploadProgress=_(r).map("uploadProgress").reduce(function(e,i){return e+i})/r.length})}),i.all(r).then(t.close).finally(function(){e.uploadProgress=100,e.uploading=!1})}e.uploading=!1,e.uploadProgress=0,e.allowMultipleFiles=!1,e.filesRequired=!0,e.files=[],e.upload=r,e.dismiss=t.dismiss}angular.module("c8y.parts.appArchives").controller("ArchivesUploadCtrl",["$scope","$q","$uibModalInstance","c8yApplication","app",e])}(),function(){"use strict";function e(e){var i;i='<c8y-breadcrumbs-set>\n  <c8y-breadcrumbs-item path="#applications" label="{{\'Own applications\' | translate}}" icon="c8y-modules"></c8y-breadcrumbs-item>\n</c8y-breadcrumbs-set>\n\n<c8y-ui-action-bar-set>\n  <c8y-refresh-btn></c8y-refresh-btn>\n</c8y-ui-action-bar-set>\n\n\n<div class="row">\n  <div class="col-sm-8">\n\n    <div class="c8y-empty-state text-center" ng-show="vm.archives.length === 0">\n      <h1 c8y-icon="archive"></h1>\n      <h3 translate>Archives listing is currently not supported for this application.</h3>\n    </div>\n    \n    <ul class="timeline-list">\n      <li class="timeline-list-item flex-row" ng-repeat="archive in vm.archives | orderBy:\'-created\'" ng-class="{\'active\': vm.isActive(archive)}">\n        <small class="timeline-item-date text-right">\n          <strong ng-bind="archive.created |  absoluteDateTimeFormat:\'D MMM YYYY\'"></strong><br/>\n          <span class="text-muted" ng-bind="archive.created | absoluteTime"></span>\n        </small>\n        <div class="timeline-item-content flex-row">\n          <div class="list-item-icon">\n            <i c8y-icon="{{$last ? \'flag-checkered\' : \'file-zip-o\'}}"></i>\n          </div>\n          <div class="list-item-body">\n            <span class="text-truncate"><span ng-bind="archive.name"></span> <small class="text-muted" ng-bind="archive.length | bytes"></small></span>\n            <small class="text-muted" ng-bind="archive.description"></small>\n          </div>\n\n          <i class="fa fa-circle-o-notch fa-spin" title="{{\'Activating\' | translate }}" ng-if="vm.requestInProgress && vm.toActivate(archive)"></i>\n\n          <div class="list-item-actions" ng-if="!vm.requestInProgress">\n            <div class="dropdown clearfix" ng-if="!vm.isActiveArchive(archive)" uib-dropdown>\n              <button type="button" class="dropdown-toggle c8y-dropdown" aria-haspopup="true" aria-expanded="false" uib-dropdown-toggle>\n                <i c8y-icon="ellipsis-v"></i>\n              </button>\n              <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1" uib-dropdown-menu>\n                <li>\n                  <a href="" ng-click="vm.setActive(archive)" ng-disabled="vm.requestInProgress || refreshLoading">\n                    <i c8y-icon="check-square-o"></i> {{\'Set as active\' | translate}}\n                   </a>\n                </li>\n                <li ng-if="!$last">\n                  <a href="" ng-click="vm.deleteArchive(archive)" ng-disabled="vm.requestInProgress || refreshLoading">\n                    <i c8y-icon="times"></i> {{\'Remove\' | translate}}\n                  </a>\n                </li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n  <div class="col-sm-4">\n    <c8y-if-allowed any-role="[\'ROLE_INVENTORY_ADMIN\', \'ROLE_INVENTORY_CREATE\']">\n      <file-picker files="vm.appArchives" multiple="false" required="true" data-disabled="vm.requestInProgress || refreshLoading" display-drop-zone="true" drop-zone-label="\'Upload archive\' | translate" processing-status="vm.uploadStatus" on-file-selected="vm.uploadArchive()">\n      </file-picker>\n    </c8y-if-allowed>\n  </div>\n</div>',e.put("archivesEditor/views/index.html",i),e.put("administration_archivesEditor/views/index.html",i),e.put("/apps/administration/archivesEditor/views/index.html",i),i='<div class="modal-header" ng-show="title">\n  <h3>{{title | translate}}</h3>\n</div>\n<div class="modal-body">\n  <form role="form" name="filesUploadForm" class="panel-body" novalidate>\n    <div class="form-group">\n      <label translate>Archives to upload</label>\n      <i c8y-icon="question-circle" uib-tooltip="{{\'Compressed files must have an index.html at root. URLs in the web application can be relative.\' | translate}}"></i>\n      <file-picker files="files" multiple="allowMultipleFiles" required="filesRequired" disabled="uploading"></file-picker>\n    </div>\n  </form>\n</div>\n<div class="modal-footer">\n  <button class="btn btn-primary" ng-click="upload()" ng-disabled="filesUploadForm.$invalid || uploading">\n      <span ng-show="uploading"><i c8y-icon="spinner" class="fa-spin"></i> <translate>Uploading</translate>&hellip; ({{uploadProgress|number:0}}%)</span>\n    <span ng-show="!uploading" translate>Upload</span>\n  </button>\n  <button class="btn btn-default" ng-click="dismiss()" ng-disabled="uploading" translate>Cancel</button>\n</div>\n',e.put("archivesEditor/views/upload.html",i),e.put("administration_archivesEditor/views/upload.html",i),e.put("/apps/administration/archivesEditor/views/upload.html",i)}angular.module("c8y.parts.appArchives").run(["$templateCache",e])}();