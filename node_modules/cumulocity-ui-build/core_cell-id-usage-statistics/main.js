/* core_cell-id-usage-statistics 9.12.5 2018-08-27T16:53:28+00:00 b689bea882f7+ (release/9.12.0) tip */
function _asyncToGenerator(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function a(s,i){try{var r=e[s](i),c=r.value}catch(t){return void n(t)}return r.done?void t(c):Promise.resolve(c).then(function(t){a("next",t)},function(t){a("throw",t)})}return a("next")})}}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function _asyncToGenerator(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function a(s,i){try{var r=e[s](i),c=r.value}catch(t){return void n(t)}return r.done?void t(c):Promise.resolve(c).then(function(t){a("next",t)},function(t){a("throw",t)})}return a("next")})}}!function(){"use strict";angular.module("c8y.cellIdUsageStatistics",[])}(),function(){"use strict";var t=_.identity;angular.module("c8y.cellIdUsageStatistics").constant("cellIdUsageStatisticsConstants",{TENANT_STATS_SERVICE_ENDPOINT:"service/cellid/statistics/summary",SUBTENANTS_STATS_SERVICE_ENDPOINT:"service/cellid/statistics/allTenantsSummary",SUBTENANT_STATS_COLUMNS:{tenantId:{name:"tenantId",header:t("ID"),cell:{template:"{{item.tenantId}}"},filteringByPattern:{itemProperty:"tenantId"},sortingByPath:{itemProperty:"tenantId"}},apiRequests:{name:"apiRequests",header:t("API requests"),cell:{template:"{{item.apiRequests}}"},filteringByMinMax:{itemProperty:"apiRequests"},sortingByPath:{itemProperty:"apiRequests"}},activeDevices:{name:"activeDevices",header:t("Active devices"),cell:{template:"{{item.activeDevices}}"},filteringByMinMax:{itemProperty:"activeDevices"},sortingByPath:{itemProperty:"activeDevices"}}}})}(),function(){"use strict";function t(t,e,n){function a(t,e){return e.isCellIDMicroserviceAvailable().then(function(e){return e&&t.mustHaveAnyRole(["ROLE_TENANT_STATISTICS_READ"])})}a.$inject=["c8yPermissions","cellIdUsageStatisticsService"],t.addNavigation({parent:n("Tenants"),name:n("Cell ID usage statistics"),path:"cellid-statistics",icon:"sellsy",showIf:a}),e.when("/cellid-statistics",{template:"<c8y-cell-id-usage-statistics></c8y-cell-id-usage-statistics>",showIf:a})}t.$inject=["c8yNavigatorProvider","c8yViewsProvider","gettext"],angular.module("c8y.cellIdUsageStatistics").config(t)}(),function(){"use strict";function t(t,e,n,a){function s(){return[n.getColumn(d.tenantId),n.getColumn(d.apiRequests),n.getColumn(d.activeDevices)]}function i(t){return{tenantId:_.get(t,"tenant"),apiRequests:_.get(t,"statistics.apiRequests",0),activeDevices:_.get(t,"statistics.activeDevices",0)}}var r=function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function n(a){var s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.t0=e,n.next=4,t.get(e.url(u),{params:e.timeOrderFilter(e.pageSizeNoTotalFilter(a)),silentError:!0});case 4:return n.t1=n.sent,s=n.t0.getResData.call(n.t0,n.t1),n.abrupt("return",i(s));case 9:return n.prev=9,n.t2=n.catch(0),n.abrupt("return",i({}));case 12:case"end":return n.stop()}},n,this,[[0,9]])}));return function(t){return n.apply(this,arguments)}}(),c=function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function n(a){var s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.t0=e,n.next=4,t.get(e.url(l),{params:e.timeOrderFilter(e.pageSizeNoTotalFilter(a)),silentError:!0});case 4:return n.t1=n.sent,s=n.t0.getResData.call(n.t0,n.t1),n.abrupt("return",_.map(s,i));case 9:return n.prev=9,n.t2=n.catch(0),n.abrupt("return",[]);case 12:case"end":return n.stop()}},n,this,[[0,9]])}));return function(t){return n.apply(this,arguments)}}(),o=function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.get(e.url(u),{params:{dateFrom:moment().format(e.dateFormat)},silentError:!0});case 3:return n.abrupt("return",!0);case 6:return n.prev=6,n.t0=n.catch(0),n.abrupt("return",!1);case 9:case"end":return n.stop()}},n,this,[[0,6]])}));return function(){return n.apply(this,arguments)}}(),u=a.TENANT_STATS_SERVICE_ENDPOINT,l=a.SUBTENANTS_STATS_SERVICE_ENDPOINT,d=a.SUBTENANT_STATS_COLUMNS,m={getSubtenantListColumns:s,getTenantStatisticsFor:r,getSubtenantsStatisticsFor:c,isCellIDMicroserviceAvailable:o};return m}t.$inject=["$http","c8yBase","c8yFilteringSortingCollections","cellIdUsageStatisticsConstants"],angular.module("c8y.cellIdUsageStatistics").factory("cellIdUsageStatisticsService",t)}(),function(){"use strict";function t(t,e,n,a,s,i,r,c,o){function u(){s.changeTitle({title:o("Cell ID usage statistics")})}function l(){var t=n.dateFrom,e=n.dateTo,a=moment().startOf("month").toDate(),s=moment().add(1,"day").toDate();b.dateFrom=r.stringToDate(t)||a,b.dateTo=r.stringToDate(e)||s}function d(){b.subtenantList.columns=c.getSubtenantListColumns()}function m(){b.subtenantList.csvHeaders=_.map(b.subtenantList.columns,function(t){return _.get(t,"header.csv")||_.get(t,"header.text")||_.get(t,"header")})}function p(){var t=v();t.dateFrom&&t.dateTo&&a.search(t)}function v(){return{dateFrom:r.dateToString(b.dateFrom),dateTo:r.dateToString(b.dateTo)}}function g(){a.search({})}function f(){return _.map([b.tenantStatistics].concat(_toConsumableArray(b.subtenantList.filteredSortedStatisticsItems)),function(t){return _.at(t,["tenantId","apiRequests","activeDevices"])})}function S(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.subtenantList.columnsConfig;b.subtenantList.columnsConfig=t;var e=b.subtenantList,n=e.statisticsItems,a=e.columns;return i.filterSort(n,a,t)}var y=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u(),t.next=3,h();case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),h=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l(),e.next=3,T();case 3:d(),m(),b.subtenantList.filteredSortedStatisticsItems=S(),t.$apply();case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),T=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var n,a,s,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=v(),t.next=3,e.all({tenantStatistics:c.getTenantStatisticsFor(n),subtenantsStatistics:c.getSubtenantsStatisticsFor(n)});case 3:a=t.sent,s=a.tenantStatistics,i=a.subtenantsStatistics,b.tenantStatistics=s,b.subtenantList.statisticsItems=i;case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),b=this;_.assign(b,{$onInit:y,refresh:h,doFilter:p,clearFilter:g,tenantStatistics:{tenantId:void 0,apiRequests:0,activeDevices:0},subtenantList:{csvHeaders:[],csvData:f,columns:[],columnsConfig:{},onColumnsConfigChanged:function(t){b.subtenantList.filteredSortedStatisticsItems=S(t)},statisticsItems:[],filteredSortedStatisticsItems:[],goToSubtenant:function(t){var e=t.tenantId;a.path("/tenants/"+e)}}})}t.$inject=["$rootScope","$q","$routeParams","$location","c8yTitle","c8yFilteringSortingCollections","c8yUtil","cellIdUsageStatisticsService","gettext"],angular.module("c8y.cellIdUsageStatistics").component("c8yCellIdUsageStatistics",{templateUrl:"core_cell-id-usage-statistics/cell-id-usage-statistics.html",controllerAs:"vm",controller:t})}(),function(){"use strict";function t(t){var e;e='<c8y-ui-action-bar-set>\n  <li class="navbar-form" action-bar-position="left">\n    <form class="form-inline">\n      <label style="padding-right: 5px" translate>Statistic period:</label>\n      <div class="form-group datepicker">\n        <input class="form-control" placeholder="{{\'From`date`\' | translate}}" uib-datepicker-popup ng-model="vm.dateFrom" datepicker-options="{maxDate: vm.dateTo}" is-open="vm.dateFromOpened" ng-click="vm.dateFromOpened=true" style="width: 120px; text-align: center">\n      </div>\n      <div class="form-group datepicker">\n        <input class="form-control" placeholder="{{\'To`date`\' | translate}}" uib-datepicker-popup ng-model="vm.dateTo" datepicker-options="{minDate: vm.dateFrom}" is-open="vm.dateToOpened" ng-click="vm.dateToOpened=true" style="width: 120px; text-align: center">\n      </div>\n      <button type="button" class="btn btn-link" ng-click="vm.doFilter()" title="{{\'Filter\' | translate}}">\n        <i c8y-icon="filter"></i> <span translate>Filter</span>\n      </button>\n      <button type="button" class="btn btn-link" ng-if="vm.dateFrom || vm.dateTo" ng-click="vm.clearFilter()" title="{{\'Clear\' | translate}}">\n        <i c8y-icon="times"></i> <span translate>Clear</span>\n      </button>\n    </form>\n  </li>\n\n  <button class="btn btn-link" c8y-csv-exporter c8y-headers="vm.subtenantList.csvHeaders" c8y-data="vm.subtenantList.csvData()">\n    <i c8y-icon="table"></i> <span translate>Export CSV</span>\n  </button>\n\n  <button type="button" class="btn btn-link" ng-click="vm.refresh()">\n    <i c8y-icon="refresh" ng-class="{\'fa-spin\': refreshLoading}"></i>\n    <span translate>Reload</span>\n  </button>\n</c8y-ui-action-bar-set>\n\n<div class="row">\n  <div ng-if="vm.tenantStatistics.tenantId !== undefined" class="col-sm-6">\n    <div class="card">\n      <div class="card-header">{{vm.tenantStatistics.tenantId}}</div>\n      <hr>\n      <ul class="list-group">\n        <li class="list-group-item">\n          {{vm.tenantStatistics.apiRequests}}\n          <span translate>API requests</span>\n        </li>\n        <li class="list-group-item">\n          {{vm.tenantStatistics.activeDevices}}\n          <span translate>active devices</span>\n        </li>\n      </ul>\n    </div>\n  </div>\n\n  <c8y-filtered-sorted-list ng-if="vm.subtenantList.filteredSortedStatisticsItems.length > 0" class="col-sm-6" columns="vm.subtenantList.columns" columns-config="vm.subtenantList.columnsConfig" on-columns-config-changed="vm.subtenantList.onColumnsConfigChanged(columnsConfig)" items="vm.subtenantList.filteredSortedStatisticsItems" on-item-click="vm.subtenantList.goToSubtenant(item)">\n  </c8y-filtered-sorted-list>\n</div>\n',t.put("cell-id-usage-statistics/cell-id-usage-statistics.html",e),t.put("core_cell-id-usage-statistics/cell-id-usage-statistics.html",e),t.put("/apps/core/cell-id-usage-statistics/cell-id-usage-statistics.html",e)}angular.module("c8y.cellIdUsageStatistics").run(["$templateCache",t])}();