/* core_deviceRegistrationActilityProvider 9.12.5 2018-08-27T16:54:02+00:00 b689bea882f7+ (release/9.12.0) tip */
!function(){"use strict";function e(e){e.add({name:"actility",featureAppName:"actility",label:"LoRa",flow:{single:["actility","finish"],multiple:["providers-list","actility","finish"]},registrationCfg:{showIfPermissions:{anyRole:["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"]}}})}e.$inject=["c8yDeviceProvidersProvider"],angular.module("c8y.deviceRegistrationActility",["c8y.deviceRegistration"]).config(e)}(),function(){"use strict";function e(e,i,t,n,c){function r(){n.doResize()}function a(){e.all([l(),s(),o()]).catch(function(e){g.errMsg.push(e.data)}).finally(function(){g.providerSettingsLoaded=!0})}function l(){return t.getDeviceTypes().then(function(e){g.deviceTypes=_.uniqBy(e,"id"),0===e.length&&v(p)})}function s(){return t.getConnectivityPlans().then(d).then(function(e){g.connectivityPlans=_.uniqBy(e,"id"),0===g.connectivityPlans.length&&v(y)})}function o(){return t.getDeviceProfiles().then(function(e){g.deviceProfiles=_.uniqBy(e,"id"),0===e.length&&v(f)})}function d(e){return _.filter(e,function(e){return _.parseInt(e.grantedConnections)>_.parseInt(e.usedConnections)})}function v(e){g.errMsg.push({message:e})}function m(){n.disableInteractionWhenRequestInProgress(g,!0),n.setFormData(g.wizardCtrl.data,{device:g.device}),t.createNewDeviceRequest(u(g.device)).then(function(e){n.setSuccessData(g.wizardCtrl.data,e),g.wizardCtrl.goTo("finish")}).catch(function(e){n.setErrorData(g.wizardCtrl.data,e),g.wizardCtrl.goTo("finish")}).finally(function(){n.disableInteractionWhenRequestInProgress(g,!1),i(r,500)})}function u(e){var i=_.pick(e.deviceType,["name","id"]),t=_.cloneDeep(e);return _.unset(t,"deviceType"),_.set(t,"deviceType",i),t}var g=this;_.assign(g,{$onInit:a,save:m,doResize:r,errMsg:[]});var p=c("No device types configured. Create a LoRa device type using device database."),y=c("No connectivity plans with free slots available."),f=c("No device profiles.")}e.$inject=["$q","$timeout","deviceRegistrationActilityProviderService","deviceRegistrationWizardUtils","gettext"],angular.module("c8y.deviceRegistrationActility").component("deviceRegistrationActility",{controllerAs:"vm",templateUrl:"core_deviceRegistrationActilityProvider/deviceRegistrationActility.html",require:{wizardCtrl:"^c8yWizardStep"},bindings:{backStep:"@?"},controller:e})}(),function(){"use strict";function e(e,i,t){function n(){return e(o.connectivityPlans).then(i.getResData)}function c(){return t.getAvailableDeviceTypes({type:"c8y_ActilityDeviceType"})}function r(){return e(o.deviceProfiles).then(i.getResData)}function a(t){return e(_.assign({},o.newDeviceRequest,{data:t})).then(i.getResData)}var l=i.url("service/actility"),s={},o={connectivityPlans:{url:l+"/connectivityPlans",method:"GET",silentError:!0},newDeviceRequest:{url:l+"/newDeviceRequest",method:"POST",silentError:!0},deviceProfiles:{url:l+"/deviceProfiles",method:"GET",silentError:!0}};return _.assign(s,{getConnectivityPlans:n,getDeviceTypes:c,createNewDeviceRequest:a,getDeviceProfiles:r}),s}e.$inject=["$http","c8yBase","c8yDeviceDatabase"],angular.module("c8y.deviceRegistrationActility").factory("deviceRegistrationActilityProviderService",e)}(),function(){"use strict";function e(e){var i;i='<div class="modal-inner-scroll" style="min-height: 225px">\n  <div ng-form="vm.deviceForm" ng-if="vm.connectivityPlans.length && vm.deviceTypes.length && vm.deviceProfiles.length" class="modal-body">\n    <div ng-init="vm.doResize()"></div>\n    <div class="form-group">\n      <label translate>Device profiles</label>\n      <ui-select name="profile" class="form-control text-left" ng-model="vm.device.deviceProfile" required>\n        <ui-select-match placeholder="{{\'Select device profile\'| translate}}">{{vm.device.deviceProfile.name}}</ui-select-match>\n        <ui-select-choices repeat="dp in vm.deviceProfiles | filter: $select.search track by dp.id | orderBy:\'name\'">\n          <span ng-bind-html="dp.name | highlight: $select.search" title="{{dp.name}}"></span>\n        </ui-select-choices>\n      </ui-select>\n      <c8y-error-feedback field="vm.deviceForm.profile"></c8y-error-feedback>\n    </div>\n    <div class="form-group">\n      <label translate>Device type</label>\n      <ui-select name="type" class="form-control text-left" ng-model="vm.device.deviceType" required>\n        <ui-select-match placeholder="{{\'Select device type\'| translate}}">{{vm.device.deviceType.name}}</ui-select-match>\n        <ui-select-choices repeat="dt in vm.deviceTypes | filter: $select.search track by dt.id | orderBy:\'name\'">\n          <span ng-bind-html="dt.name | highlight: $select.search" title="{{dt.name}}"></span>\n        </ui-select-choices>\n      </ui-select>\n      <c8y-error-feedback field="vm.deviceForm.type"></c8y-error-feedback>\n    </div>\n    <div class="form-group">\n      <label translate>Device EUI</label>\n      <input type="text" name="eui" class="form-control" ng-model="vm.device.devEUI" ng-pattern="/^([0-9A-F]{2}){8}$/i" placeholder="{{\'e.g.\' | translate}} 0018A20000000004" required/>\n      <c8y-error-feedback field="vm.deviceForm.eui"></c8y-error-feedback>\n    </div>\n    <div class="form-group">\n      <label translate>Application key</label>\n      <input type="text" name="appKey" class="form-control" ng-model="vm.device.applicationKey" ng-pattern="/^([0-9A-F]{2}){16}$/i" placeholder="{{\'e.g.\' | translate}} 258DB54023EA74F0D55085F7351737D0" required/>\n      <c8y-error-feedback field="vm.deviceForm.appKey"></c8y-error-feedback>\n    </div>\n    <div class="form-group">\n      <label translate>Connectivity plan</label>\n      <ui-select name="connectivityPlan" class="form-control text-left" ng-model="vm.device.connectivityPlan" required>\n        <ui-select-match placeholder="{{\'Select device type\'| translate}}">{{vm.device.connectivityPlan.name}}</ui-select-match>\n        <ui-select-choices repeat="cp in vm.connectivityPlans | filter: $select.search track by cp.id | orderBy:\'name\'">\n          <span ng-bind-html="cp.name | highlight: $select.search" title="{{cp.name}}"></span>\n        </ui-select-choices>\n      </ui-select>\n      <small class="text-muted" style="display: block" translate>Only connectivity plans with free slots are displayed</small>\n      <c8y-error-feedback field="vm.deviceForm.connectivityPlan"></c8y-error-feedback>\n    </div>\n  </div>\n  <div class="text-center" ng-if="!vm.providerSettingsLoaded && !(vm.connectivityPlans.length && vm.deviceTypes.length && vm.deviceProfiles.length)" style="margin: 100px 0 50px 0; height: 150px">\n    <i c8y-icon="circle-o-notch" class="fa-spin"></i>\n    <span translate>Wait while provider settings are loaded&hellip;</span>\n  </div>\n  <div class="alert alert-danger" ng-if="vm.providerSettingsLoaded && !(vm.connectivityPlans.length && vm.deviceTypes.length && vm.deviceProfiles.length)" style="margin: 15px">\n    <div ng-repeat="msg in vm.errMsg">\n      <span>{{msg.message| translateServerMessage}}</span>\n    </div>\n  </div>\n  <div class="c8y-wizard-footer">\n    <button class="btn btn-default" ng-click="vm.wizardCtrl.goTo(vm.backStep)" ng-disabled="vm.inProgress" translate>\n      Back\n    </button>\n    <button class="btn btn-primary" ng-click="vm.save()" ng-disabled="vm.deviceForm.$invalid || vm.errMsg.length || vm.inProgress">\n      <span ng-show="!vm.inProgress" translate>Next</span>\n      <span ng-show="vm.inProgress">\n        <i c8y-icon="circle-o-notch" class="fa-spin"></i>\n      </span>\n    </button>\n  </div>\n</div>\n',e.put("deviceRegistrationActilityProvider/deviceRegistrationActility.html",i),e.put("core_deviceRegistrationActilityProvider/deviceRegistrationActility.html",i),e.put("/apps/core/deviceRegistrationActilityProvider/deviceRegistrationActility.html",i)}angular.module("c8y.deviceRegistrationActility").run(["$templateCache",e])}();